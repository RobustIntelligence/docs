<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Defining a Model Interface &mdash; Robust Intelligence  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.13.1/sb-1.4.0/datatables.min.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="../../_static/main.js"></script>
        <script src="https://cdn.datatables.net/v/dt/dt-1.13.1/sb-1.4.0/datatables.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Uploading to Cloud Storage (Optional)" href="upload_data.html" />
    <link rel="prev" title="Preprocessing Your Datasets" href="preprocessing_your_datasets.html" />
<link href="../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">
<div class="ge_header no-print">
    <a id="header-logo" href="../../index.html">
        <img src="../../_static/images/header-logo.png" alt="logo" />
    </a>
</div>


  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Robust Intelligence
          </a>
              <div class="version">
                2.6.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation Home</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation_home/robust_intelligence_intro.html">What is Robust Intelligence?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation_home/get_started.html">Get Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Testing</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../creating_projects.html">Creating Projects</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../preparing_your_models_and_datasets.html">Preparing Your Models and Datasets</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="preprocessing_your_datasets.html">Preprocessing Your Datasets</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Defining a Model Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1-specify-model-path">Step 1: Specify model path</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2-retrieve-custom-code">Step 2: Retrieve custom code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3-access-the-model">Step 3: Access the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-4-import-implement-preprocessing-function">Step 4: Import / implement preprocessing function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-5-implement-a-predict-function">Step 5: Implement a predict function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-6-passing-secrets-to-the-model">Step 6: Passing secrets to the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#related-topics">Related Topics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="upload_data.html">Uploading to Cloud Storage (Optional)</a></li>
<li class="toctree-l2"><a class="reference internal" href="registering_model_datasets.html">Registering Models, Datasets, and Predictions</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_source.html">Data Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="model_source.html">Model Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="file_scanning.html">Securing Model Supply Chain Risk with File Scanning</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../validating_models.html">Validate Models with Stress Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring_models.html">Scheduled Stress Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuring_test_runs.html">Configuring your Test Runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../querying_results.html">Querying Test Run Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notifications_and_alerts.html">Notifications and Alerts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_governance.html">Managing Model Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrating_mlops.html">Integrating with MLOps</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../administration/organization_administration.html">Organization Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/workspace_configuration.html">Workspace Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/security_and_compliance.html">Security and Compliance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/upgrade.html">Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/model_tests_reference.html">Model Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/python-sdk.html">Python SDK Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/troubleshooting.html">Troubleshooting Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/api_changelog.html">API Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/versions.html">Versioning and compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/legal.html">Robust Intelligence Terms and Conditions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Robust Intelligence</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../documentation_home/get_started.html">Get Started</a></li>
          <li class="breadcrumb-item"><a href="../../documentation_home/notebooks.html">Tutorial Notebooks</a></li>
          <li class="breadcrumb-item"><a href="../preparing_your_models_and_datasets.html">Preparing Your Models and Datasets</a></li>
      <li class="breadcrumb-item active">Defining a Model Interface</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="defining-a-model-interface">
<h1>Defining a Model Interface<a class="headerlink" href="#defining-a-model-interface" title="Permalink to this heading"></a></h1>
<p>Robust Intelligence expects models to be passed in as Python files that expose one of the following functions:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">predict_dict</span></code>: the input is a single row in dictionary form (e.g. <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">{'Age':</span> <span class="pre">15,</span> <span class="pre">'Animal':</span> <span class="pre">'Cat',</span> <span class="pre">...}</span></code>). The return type will depend on the model task. For example,
the output for binary classification should be a float value between 0 and 1, and
for regression it can be an unbounded float. The function signature for either case
should look like: <code class="docutils literal notranslate"><span class="pre">predict_dict(x:</span> <span class="pre">dict)</span> <span class="pre">-&gt;</span> <span class="pre">float</span></code>. For multi-class classification
the output should be a numpy array where the i’th element represents the predicted
probability for the i;th class. The function signature
changes slightly to look like: <code class="docutils literal notranslate"><span class="pre">predict_dict(x:</span> <span class="pre">dict)</span> <span class="pre">-&gt;</span> <span class="pre">np.ndarray</span></code>. For details on
the prediction formats for all model tasks, see the
<a class="reference internal" href="preprocessing_your_datasets.html"><span class="std std-doc">Preprocessing your Datasets</span></a> page.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">predict_df</span></code>: the input is a Pandas DataFrame, and the output is a NumPy array.
If the model task is multi-class classification or natural language inference, the
output should be a NumPy array of floats of shape <code class="docutils literal notranslate"><span class="pre">(len(df),</span> <span class="pre">num_classes)</span></code>. For all
other model tasks, the output should be a NumPy array of floats of shape <code class="docutils literal notranslate"><span class="pre">(len(df),)</span></code>,
with each element satisfying the prediction format specifies in
<a class="reference internal" href="preprocessing_your_datasets.html"><span class="std std-doc">Preprocessing your Datasets</span></a>.
In any case, the function signature should look like: <code class="docutils literal notranslate"><span class="pre">predict_df(df:</span> <span class="pre">pd.DataFrame)</span> <span class="pre">-&gt;</span> <span class="pre">np.ndarray</span></code></p>
<p>NOTE: for binary classification the return type should be a single float per row which represents the probability for the positive class. It should not be an array of probabilities for each class. E.g. <code class="docutils literal notranslate"><span class="pre">predict_df</span></code> should return <code class="docutils literal notranslate"><span class="pre">[0.7,</span> <span class="pre">0.1,</span> <span class="pre">...]</span></code> NOT <code class="docutils literal notranslate"><span class="pre">[[0.3,</span> <span class="pre">0.7],</span> <span class="pre">[0.9,</span> <span class="pre">0.1],</span> <span class="pre">...]</span></code>.</p>
</li>
</ul>
<p>The following shows how to set up the Python interface Robust Intelligence expects for a model that can be called via loading a model binary.</p>
<blockquote>
<div><p><strong>As of v2.1, Robust Intelligence supports models written in Python 3.8 to 3.11. Any model files written in Python 3.7 should be migrated to Python 3.8 or later.</strong></p>
</div></blockquote>
<section id="step-1-specify-model-path">
<h2>Step 1: Specify model path<a class="headerlink" href="#step-1-specify-model-path" title="Permalink to this heading"></a></h2>
<p>Put your model binary, and any other relevant model artifacts, in the same folder as this file.
Create a constant for the path to this binary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">cur_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span>

<span class="n">MODEL_NAME</span> <span class="o">=</span> <span class="s1">&#39;TODO: change this to model name&#39;</span>
<span class="n">MODEL_PATH</span> <span class="o">=</span> <span class="n">cur_dir</span> <span class="o">/</span> <span class="n">MODEL_NAME</span>
</pre></div>
</div>
</section>
<section id="step-2-retrieve-custom-code">
<h2>Step 2: Retrieve custom code<a class="headerlink" href="#step-2-retrieve-custom-code" title="Permalink to this heading"></a></h2>
<p>If custom code is needed to perform preprocessing on the data (or to call your API), we need to make sure it is loaded into the environment. If this code is able to be installed as a Python package, see the <code class="docutils literal notranslate"><span class="pre">Custom</span> <span class="pre">Requirements</span></code> section.</p>
<p>If your code is NOT a Python package (and is instead a Python file or folder) then please put all relevant files in the same directory as this file, and add the following snippet to the Python file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cur_dir</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="step-3-access-the-model">
<h2>Step 3: Access the model<a class="headerlink" href="#step-3-access-the-model" title="Permalink to this heading"></a></h2>
<p>As an example, if you used the Python <code class="docutils literal notranslate"><span class="pre">pickle</span></code> module to save your model this would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">MODEL_PATH</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="step-4-import-implement-preprocessing-function">
<h2>Step 4: Import / implement preprocessing function<a class="headerlink" href="#step-4-import-implement-preprocessing-function" title="Permalink to this heading"></a></h2>
<p>If the model you are using expects inputs of a different schema than the datasets you’ve provided, or of a different type than <code class="docutils literal notranslate"><span class="pre">dict</span></code>/<code class="docutils literal notranslate"><span class="pre">Pandas.DataFrame</span></code>, you will need to load/define all custom preprocessing. If your model can take in the raw data directly then you can skip this step! Getting the preprocessing functionality could look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">custom_package</span> <span class="kn">import</span> <span class="n">preprocessing</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">preprocessing</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelInputType</span><span class="p">:</span>
    <span class="c1"># TODO: implement preprocessing logic.</span>
</pre></div>
</div>
</section>
<section id="step-5-implement-a-predict-function">
<h2>Step 5: Implement a predict function<a class="headerlink" href="#step-5-implement-a-predict-function" title="Permalink to this heading"></a></h2>
<p>Implement either the <code class="docutils literal notranslate"><span class="pre">predict_dict</span></code> function or the <code class="docutils literal notranslate"><span class="pre">predict_df</span></code> function. For binary classification, this should look something like:</p>
<p>(NOTE: whichever you choose to implement, it must match one of the function names and signatures below.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># In multi-class case, the return type is np.ndarray</span>
<span class="k">def</span> <span class="nf">predict_dict</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">single_input</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">model_output</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">single_input</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model_output</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>OR</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predict_df</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="n">array_input</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">model_output</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">array_input</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model_output</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="step-6-passing-secrets-to-the-model">
<h2>Step 6: Passing secrets to the model<a class="headerlink" href="#step-6-passing-secrets-to-the-model" title="Permalink to this heading"></a></h2>
<p>If your model file expects to receive secrets for using during runtime, you can specify them as model endpoint integrations. As an example, you might need secrets in case the model file queries an authenticated endpoint to make predictions.</p>
<p>You may specify a <code class="docutils literal notranslate"><span class="pre">model_endpoint_integration_id</span></code> when registering the model, as described <a class="reference internal" href="registering_model_datasets.html#passing-secrets-to-the-model"><span class="std std-ref">here</span></a>. The secrets specified in the model endpoint integration would be made available to the predict function as an <code class="docutils literal notranslate"><span class="pre">integration_dict</span></code> dict parameter. The predict function signatures would then change as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predict_dict</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">integration_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;predict logic&quot;&quot;&quot;</span>
    <span class="n">API_KEY</span> <span class="o">=</span> <span class="n">integration_dict</span><span class="p">[</span><span class="s1">&#39;SECRET_API_KEY&#39;</span><span class="p">]</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>OR</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predict_df</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">integration_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;predict logic&quot;&quot;&quot;</span>
    <span class="n">API_KEY</span> <span class="o">=</span> <span class="n">integration_dict</span><span class="p">[</span><span class="s1">&#39;SECRET_API_KEY&#39;</span><span class="p">]</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="related-topics">
<h2>Related Topics<a class="headerlink" href="#related-topics" title="Permalink to this heading"></a></h2>
<p><a class="reference internal" href="preprocessing_your_datasets.html"><span class="std std-doc">Preprocessing Your Datasets</span></a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="preprocessing_your_datasets.html" class="btn btn-neutral float-left" title="Preprocessing Your Datasets" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="upload_data.html" class="btn btn-neutral float-right" title="Uploading to Cloud Storage (Optional)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Robust Intelligence.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
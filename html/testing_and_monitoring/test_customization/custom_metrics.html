<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custom Metrics &mdash; Robust Intelligence  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="https://cdn.datatables.net/v/dt/dt-1.13.1/sb-1.4.0/datatables.min.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="../../_static/main.js"></script>
        <script src="https://cdn.datatables.net/v/dt/dt-1.13.1/sb-1.4.0/datatables.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Running Tests on Managed Docker Images" href="run_tests_on_managed_images.html" />
    <link rel="prev" title="Test Customization" href="../test_customization.html" />
<link href="../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">
<div class="ge_header no-print">
    <a id="header-logo" href="../../index.html">
        <img src="../../_static/header-logo.png" alt="logo" />
    </a>
</div>


  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Robust Intelligence
          </a>
              <div class="version">
                2.0.0-rc.14
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation Home</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation_home/robust_intelligence_intro.html">What is Robust Intelligence?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation_home/get_started.html">Get Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Testing and Monitoring</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../creating_projects.html">Creating Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preparing_your_models_and_datasets.html">Preparing your Models and Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../validating_models.html">Validate Models with Stress Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring_models.html">Monitor Models with Continuous Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../querying_results.html">Querying Test Run Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notifications_and_alerts.html">Notifications and Alerts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model_governance.html">Managing Model Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuring_test_runs.html">Configuring your Test Runs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../test_customization.html">Test Customization</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Custom Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_tests_on_managed_images.html">Running Tests on Managed Docker Images</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../integrating_mlops.html">Integrating with MLOps</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../administration/organization_administration.html">Organization Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/configuring_workspaces.html">Workspace Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/security_and_compliance.html">Security and Compliance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/python-sdk.html">Python SDK reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/troubleshooting.html">Troubleshooting Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/model_tests_reference.html">Model Tests Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/api_changelog.html">API Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Robust Intelligence</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../test_customization.html">Test Customization</a></li>
      <li class="breadcrumb-item active">Custom Metrics</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="custom-metrics">
<h1>Custom Metrics<a class="headerlink" href="#custom-metrics" title="Permalink to this heading"></a></h1>
<p>This feature allows you to configure custom metrics that may be used in model performance, subset performance,
and subset performance degradation tests.
In order to use the custom metrics functionality, you first need to create a Python file that contains
the function used to calculate the custom metric. This function should be named <code class="docutils literal notranslate"><span class="pre">custom_metric_func</span></code>,
and the interface this function is expected to expose is below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="k">def</span> <span class="nf">custom_metric_func</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
    <span class="n">preds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">preds_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">],</span>
    <span class="n">query_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a custom metric.</span>
<span class="sd">    Args:</span>
<span class="sd">        df: Optional pd.DataFrame of data, will be the full data.</span>
<span class="sd">        labels: Optional pd.Series of labels, if exists will have the same length</span>
<span class="sd">            as df.</span>
<span class="sd">        preds: Optional np.array of predictions, if exists may be a subset of the</span>
<span class="sd">            full df.</span>
<span class="sd">        preds_index: Optional pd.Index of predictions, if exists will have the same</span>
<span class="sd">            length as `preds`. Can be used to align the predictions with rows in the</span>
<span class="sd">            df.</span>
<span class="sd">        query_ids: Optional pd.Series of query ids, if exists will have the same</span>
<span class="sd">            length as `df`.</span>
<span class="sd">    Returns:</span>
<span class="sd">        an optional float corresponding to the metric to be tracked.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>The arguments passed to this function depend on the your configured data and task.
The function should return <code class="docutils literal notranslate"><span class="pre">None</span></code> whenever the provided arguments are insufficent, such as when labels are required but not available.</p>
<p>NOTE: for unstructured data, the dataframe will contain information about user-defined metadata for
each datapoint and any profiled attributes. For tabular data, the dataframe will be the raw features.</p>
<p>After defining this function, you then need to specify it in the <code class="docutils literal notranslate"><span class="pre">model_profiling</span></code> section of the JSON configuration object.
<a class="reference internal" href="#../configuring_test_runs/model_profiling.md"><span class="xref myst">Model Profiling</span></a> discusses this object in more detail.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;model_profiling&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;custom_metrics&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NAME_OF_METRIC&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;file_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;path/to/file.py&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;range_lower_bound&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;range_upper_bound&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;run_subset_performance&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;run_subset_performance_drift&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;run_overall_performance&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="nt">&quot;short_description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="nt">&quot;starter_description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="nt">&quot;why_it_matters_description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="nt">&quot;configuration_description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">               </span><span class="nt">&quot;example_description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">file_path</span></code> are required parameters. Replace <code class="docutils literal notranslate"><span class="pre">NAME_OF_METRIC</span></code> with the name of the metric (this is how it will show up in the UI). Replace <code class="docutils literal notranslate"><span class="pre">path/to/file.py</span></code>
with the path to the Python file you created in the above step.</p>
<p>All other parameters are optional.</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">range_lower_bound</span></code></strong>: float, <em>default</em> = 0
The lower bound of the valid range for the metric.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">range_upper_bound</span></code></strong>: float, <em>default</em> = 1
The upper bound of the valid range for the metric.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">run_subset_performance</span></code></strong>: bool, <em>default</em> = <code class="docutils literal notranslate"><span class="pre">True</span></code>
If metric should be included in subset performance category</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">run_subset_performance_drift</span></code></strong>: bool, <em>default</em> = <code class="docutils literal notranslate"><span class="pre">False</span></code>
If metric should be included in subset performance drift category</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">run_overall_performance</span></code></strong>: bool, <em>default</em> = <code class="docutils literal notranslate"><span class="pre">True</span></code>
If metric should be included in model performance category</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">metadata</span></code></strong>: dict,
Descriptions of the metric composed of the components listed below</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">short_description</span></code></strong>: string, short description for each metric</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">starter_description</span></code></strong>: string, contents of “Description” tab within “More” pop-up</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">why_it_matters_description</span></code></strong>: string, contents of “Why It Matters” tab within “More” pop-up</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">configuration_description</span></code></strong>: string, contents of “Configuration” tab within “More” pop-up</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">example_description</span></code></strong>: string, contents of “Example” tab within “More” pop-up</p></li>
</ul>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../test_customization.html" class="btn btn-neutral float-left" title="Test Customization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="run_tests_on_managed_images.html" class="btn btn-neutral float-right" title="Running Tests on Managed Docker Images" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Robust Intelligence.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
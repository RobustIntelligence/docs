<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analyzing Subset Performance &mdash; RIME  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="https://cdn.datatables.net/v/dt/dt-1.13.1/sb-1.4.0/datatables.min.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/main.js"></script>
        <script src="https://cdn.datatables.net/v/dt/dt-1.13.1/sb-1.4.0/datatables.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="API Test Reference" href="../reference.html" />
    <link rel="prev" title="Adversarial Attacks" href="rime_adversarial.html" />
<link href="../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">
<div class="ge_header no-print">
    <a id="header-logo" href="../../index.html">
        <img src="../../_static/header-logo.png" alt="logo" />
    </a>
</div>


  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            RIME
          </a>
              <div class="version">
                2.0.0-beta.10
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">RIME at a Glance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getstarted/product-overview.html">RIME and machine learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getstarted/workspace-overview.html">The RIME Workspace Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getstarted/modeltesting.html">RIME model testing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Testing and monitoring models with RIME</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../for_data_scientists/get_started.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../for_data_scientists/basic_tasks.html">Setting up and testing with RIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../for_data_scientists/adv_tasks.html">Customization and troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../for_data_scientists/reference.html">Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administering RIME</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../for_admins/userauthnz.html">Users, authorization, and authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../for_admins/naviconf.html">Navigating and configuring RIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../for_admins/fixtrouble.html">Troubleshooting a RIME deployment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installing RIME</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/cloudinst.html">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/mcloudinst.html">Managed Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/shostedinst.html">Self-Hosted</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SDK reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../python-sdk.html">Python SDK reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../how_to_guides.html">Python SDK tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="rime_data_model_setup.html">Data and Model Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="rime_stress_tests.html">AI Stress Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="rime_adversarial.html">Adversarial Attacks</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Analyzing Subset Performance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-rime-library-to-analyze-model-performance">Using RIME Library to Analyze Model Performance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-feature-subset-ai-stress-tests">Running Feature Subset AI Stress Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#analyzing-model-performance">Analyzing Model Performance</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#improving-model-performance-results-overweighting">Improving Model Performance Results: Overweighting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#training-the-initial-model">Training the Initial Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#comparing-improvements">Comparing Improvements</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">API Test Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dependencies.html">Dependencies</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">RIME</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../how_to_guides.html">Python SDK tutorials</a></li>
      <li class="breadcrumb-item active">Analyzing Subset Performance</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/python_library/how_to_guides/rime_subset_performance.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="analyzing-subset-performance">
<h1>Analyzing Subset Performance<a class="headerlink" href="#analyzing-subset-performance" title="Permalink to this heading"></a></h1>
<p>Complete the initial setup described in <a class="reference internal" href="rime_data_model_setup.html"><span class="doc std std-doc">RIME Data and Model Setup</span></a> before proceeding.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>The RIME Python Library offers detailed insights into the performance of different feature subsets in your data — excellent for detecting potential bias.</p>
<p>In this walkthrough, we will use AI Stress Tests to discover performance variation across feature subsets and then refine our model accordingly.</p>
</section>
<section id="using-rime-library-to-analyze-model-performance">
<h2>Using RIME Library to Analyze Model Performance<a class="headerlink" href="#using-rime-library-to-analyze-model-performance" title="Permalink to this heading"></a></h2>
<section id="running-feature-subset-ai-stress-tests">
<h3>Running Feature Subset AI Stress Tests<a class="headerlink" href="#running-feature-subset-ai-stress-tests" title="Permalink to this heading"></a></h3>
<p>In the example below, we illustrate how model accuracy varies across different subsets of the <code class="docutils literal notranslate"><span class="pre">DeviceType</span></code> categorical feature.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rime.tabular.tests</span> <span class="kn">import</span> <span class="n">FeatureSubsetTest</span>
<span class="kn">from</span> <span class="nn">rime.tabular.metric</span> <span class="kn">import</span> <span class="n">AccuracyMetric</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">FeatureSubsetTest</span><span class="p">(</span><span class="s2">&quot;DeviceType&quot;</span><span class="p">,</span> <span class="n">AccuracyMetric</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
<span class="n">test</span><span class="o">.</span><span class="n">run_notebook</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">subsets_info</span></code> dictionary, each key is a subset of the feature tested on: <code class="docutils literal notranslate"><span class="pre">desktop</span></code>, <code class="docutils literal notranslate"><span class="pre">mobile</span></code>, and <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>It contains information about the metric performance (<code class="docutils literal notranslate"><span class="pre">perf</span></code>), confidence intervals (<code class="docutils literal notranslate"><span class="pre">margin_error</span></code>), performance difference from the entire feature (<code class="docutils literal notranslate"><span class="pre">diff</span></code>), positivity rate (<code class="docutils literal notranslate"><span class="pre">pos_rate</span></code>), and other information regarding the indices and size of the subset in the feature.</p>
<p><strong>By inspecting the <code class="docutils literal notranslate"><span class="pre">worst_subset</span></code> key, we can see that the model underperforms with respect to accuracy for inputs in the <code class="docutils literal notranslate"><span class="pre">mobile</span></code> category!</strong></p>
<p><strong>Output</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;FAIL&#39;</span><span class="p">,</span>
 <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;Medium&#39;</span><span class="p">,</span>
 <span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="s1">&#39;4cb6fd45-83c0-fdd3-b393-974ef3736ead&#39;</span><span class="p">,</span>
  <span class="s1">&#39;metric_name&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">MetricName</span><span class="o">.</span><span class="n">ACCURACY</span><span class="p">:</span> <span class="s1">&#39;accuracy&#39;</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s1">&#39;metric_cls&#39;</span><span class="p">:</span> <span class="n">rime</span><span class="o">.</span><span class="n">tabular</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">shared_metrics</span><span class="o">.</span><span class="n">AccuracyMetric</span><span class="p">,</span>
  <span class="s1">&#39;min_sample_size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
  <span class="s1">&#39;perf_change_thresholds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
  <span class="s1">&#39;perf_change_threshold&#39;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
  <span class="s1">&#39;col_name&#39;</span><span class="p">:</span> <span class="s1">&#39;DeviceType&#39;</span><span class="p">},</span>
 <span class="s1">&#39;columns&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;DeviceType&#39;</span><span class="p">],</span>
 <span class="s1">&#39;num_failing&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s1">&#39;overall_perf&#39;</span><span class="p">:</span> <span class="mf">0.9692</span><span class="p">,</span>
 <span class="s1">&#39;sample_size&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
 <span class="s1">&#39;subsets_metric_dict&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;overall_perf&#39;</span><span class="p">:</span> <span class="mf">0.9692</span><span class="p">,</span>
  <span class="s1">&#39;subsets_info&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;desktop&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;desktop&#39;</span><span class="p">,</span>
    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">1504</span><span class="p">,</span>
    <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="s1">&#39;desktop&#39;</span><span class="p">,</span>
    <span class="s1">&#39;perf&#39;</span><span class="p">:</span> <span class="mf">0.9461436170212766</span><span class="p">,</span>
    <span class="s1">&#39;margin_error&#39;</span><span class="p">:</span> <span class="mf">0.011408309534789187</span><span class="p">,</span>
    <span class="s1">&#39;diff&#39;</span><span class="p">:</span> <span class="mf">0.023056382978723367</span><span class="p">,</span>
    <span class="s1">&#39;pos_rate&#39;</span><span class="p">:</span> <span class="mf">0.06648936170212766</span><span class="p">,</span>
    <span class="s1">&#39;sample_size_info&#39;</span><span class="p">:</span> <span class="p">{</span><span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">POS_LABEL</span><span class="p">:</span> <span class="s1">&#39;Positive Label&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
     <span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">NEG_LABEL</span><span class="p">:</span> <span class="s1">&#39;Negative Label&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">1404</span><span class="p">,</span>
     <span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">POS_PRED</span><span class="p">:</span> <span class="s1">&#39;Positive Prediction&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span>
     <span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">NEG_PRED</span><span class="p">:</span> <span class="s1">&#39;Negative Prediction&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">1471</span><span class="p">}},</span>
   <span class="s1">&#39;mobile&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;mobile&#39;</span><span class="p">,</span>
    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">947</span><span class="p">,</span>
    <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="s1">&#39;mobile&#39;</span><span class="p">,</span>
    <span class="s1">&#39;perf&#39;</span><span class="p">:</span> <span class="mf">0.9292502639915523</span><span class="p">,</span>
    <span class="s1">&#39;margin_error&#39;</span><span class="p">:</span> <span class="mf">0.016330589417348093</span><span class="p">,</span>
    <span class="s1">&#39;diff&#39;</span><span class="p">:</span> <span class="mf">0.039949736008447645</span><span class="p">,</span>
    <span class="s1">&#39;pos_rate&#39;</span><span class="p">:</span> <span class="mf">0.11298838437170011</span><span class="p">,</span>
    <span class="s1">&#39;sample_size_info&#39;</span><span class="p">:</span> <span class="p">{</span><span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">POS_LABEL</span><span class="p">:</span> <span class="s1">&#39;Positive Label&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">107</span><span class="p">,</span>
     <span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">NEG_LABEL</span><span class="p">:</span> <span class="s1">&#39;Negative Label&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">840</span><span class="p">,</span>
     <span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">POS_PRED</span><span class="p">:</span> <span class="s1">&#39;Positive Prediction&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
     <span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">NEG_PRED</span><span class="p">:</span> <span class="s1">&#39;Negative Prediction&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">897</span><span class="p">}},</span>
   <span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span>
    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">7549</span><span class="p">,</span>
    <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span>
    <span class="s1">&#39;perf&#39;</span><span class="p">:</span> <span class="mf">0.9788051397536097</span><span class="p">,</span>
    <span class="s1">&#39;margin_error&#39;</span><span class="p">:</span> <span class="mf">0.003249127676628865</span><span class="p">,</span>
    <span class="s1">&#39;diff&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.00960513975360977</span><span class="p">,</span>
    <span class="s1">&#39;pos_rate&#39;</span><span class="p">:</span> <span class="mf">0.021592263876010067</span><span class="p">,</span>
    <span class="s1">&#39;sample_size_info&#39;</span><span class="p">:</span> <span class="p">{</span><span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">POS_LABEL</span><span class="p">:</span> <span class="s1">&#39;Positive Label&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">163</span><span class="p">,</span>
     <span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">NEG_LABEL</span><span class="p">:</span> <span class="s1">&#39;Negative Label&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">7386</span><span class="p">,</span>
     <span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">POS_PRED</span><span class="p">:</span> <span class="s1">&#39;Positive Prediction&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
     <span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">NEG_PRED</span><span class="p">:</span> <span class="s1">&#39;Negative Prediction&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">7546</span><span class="p">}}}},</span>
 <span class="s1">&#39;worst_subset&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;mobile&#39;</span><span class="p">,</span>
  <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">947</span><span class="p">,</span>
  <span class="s1">&#39;criterion&#39;</span><span class="p">:</span> <span class="s1">&#39;mobile&#39;</span><span class="p">,</span>
  <span class="s1">&#39;perf&#39;</span><span class="p">:</span> <span class="mf">0.9292502639915523</span><span class="p">,</span>
  <span class="s1">&#39;margin_error&#39;</span><span class="p">:</span> <span class="mf">0.016330589417348093</span><span class="p">,</span>
  <span class="s1">&#39;diff&#39;</span><span class="p">:</span> <span class="mf">0.039949736008447645</span><span class="p">,</span>
  <span class="s1">&#39;pos_rate&#39;</span><span class="p">:</span> <span class="mf">0.11298838437170011</span><span class="p">,</span>
  <span class="s1">&#39;sample_size_info&#39;</span><span class="p">:</span> <span class="p">{</span><span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">POS_LABEL</span><span class="p">:</span> <span class="s1">&#39;Positive Label&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">107</span><span class="p">,</span>
   <span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">NEG_LABEL</span><span class="p">:</span> <span class="s1">&#39;Negative Label&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">840</span><span class="p">,</span>
   <span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">POS_PRED</span><span class="p">:</span> <span class="s1">&#39;Positive Prediction&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
   <span class="o">&lt;</span><span class="n">SampleSizeType</span><span class="o">.</span><span class="n">NEG_PRED</span><span class="p">:</span> <span class="s1">&#39;Negative Prediction&#39;</span><span class="o">&gt;</span><span class="p">:</span> <span class="mi">897</span><span class="p">}}}</span>
</pre></div>
</div>
</section>
<section id="analyzing-model-performance">
<h3>Analyzing Model Performance<a class="headerlink" href="#analyzing-model-performance" title="Permalink to this heading"></a></h3>
<section id="overall-analysis">
<h4>Overall Analysis<a class="headerlink" href="#overall-analysis" title="Permalink to this heading"></a></h4>
<p>When RunContainers are created, RIME profiles the model’s performance with respect to its feature subsets. We can obtain all that information very easily through built-in functions.</p>
<p>To obtain the overall performance metrics for the model, we can use <code class="docutils literal notranslate"><span class="pre">get_overall_metrics</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rime.tabular.performance.error_analysis</span> <span class="kn">import</span> <span class="n">get_overall_metrics</span>

<span class="n">get_overall_metrics</span><span class="p">(</span><span class="n">test_data_container</span><span class="p">)</span>
</pre></div>
</div>
<p>The output of the function, below, summarizes the performance of the model.</p>
<p><strong>Output</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;AUC&#39;</span><span class="p">:</span> <span class="mf">0.8373003844966462</span><span class="p">,</span>
 <span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="mf">0.9693</span><span class="p">,</span>
 <span class="s1">&#39;F1&#39;</span><span class="p">:</span> <span class="mf">0.33693304535637153</span><span class="p">,</span>
 <span class="s1">&#39;Positive Prediction Rate&#39;</span><span class="p">:</span> <span class="mf">0.0093</span><span class="p">,</span>
 <span class="s1">&#39;Average Prediction&#39;</span><span class="p">:</span> <span class="mf">0.03285634791790353</span><span class="p">,</span>
 <span class="s1">&#39;Precision&#39;</span><span class="p">:</span> <span class="mf">0.8387096774193549</span><span class="p">,</span>
 <span class="s1">&#39;False Positive Rate&#39;</span><span class="p">:</span> <span class="mf">0.001557632398753894</span><span class="p">,</span>
 <span class="s1">&#39;False Negative Rate&#39;</span><span class="p">:</span> <span class="mf">0.7891891891891891</span><span class="p">,</span>
 <span class="s1">&#39;Recall&#39;</span><span class="p">:</span> <span class="mf">0.21081081081081082</span><span class="p">,</span>
 <span class="s1">&#39;Prediction Variance&#39;</span><span class="p">:</span> <span class="mf">0.0066419034307548305</span><span class="p">,</span>
 <span class="s1">&#39;Prediction Variance (Negative Labels)&#39;</span><span class="p">:</span> <span class="mf">0.0018745259970643715</span><span class="p">,</span>
 <span class="s1">&#39;Prediction Variance (Positive Labels)&#39;</span><span class="p">:</span> <span class="mf">0.08604940885317178</span><span class="p">}</span>
</pre></div>
</div>
<p>Another tool in error analysis lets us see the model’s biggest misses.
Let’s inspect the model’s worst false positives and false negatives:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rime.tabular.performance</span> <span class="kn">import</span> <span class="n">get_biggest_errors</span>
<span class="n">fp</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">get_biggest_errors</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">model_wrapper</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is the model’s worst <strong>false positive</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">worst_fp_idx</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<span class="n">worst_fp_example</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">worst_fp_idx</span><span class="p">,:]</span>
<span class="n">worst_fp_pred</span> <span class="o">=</span> <span class="n">model_wrapper</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">worst_fp_example</span><span class="p">)</span>
<span class="n">worst_fp_label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">worst_fp_idx</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WORST FALSE POSITIVE:</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n\n</span><span class="s2">Label: </span><span class="si">{}</span><span class="s2">, Predicted Value: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">worst_fp_example</span><span class="p">,</span> <span class="n">worst_fp_label</span><span class="p">,</span> <span class="n">worst_fp_pred</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Output</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WORST</span> <span class="n">FALSE</span> <span class="n">POSITIVE</span><span class="p">:</span>
<span class="n">Timestamp</span>                    <span class="mf">3036316.0</span>
<span class="n">Product_type</span>                         <span class="n">C</span>
<span class="n">Card_company</span>                      <span class="n">visa</span>
<span class="n">Card_type</span>                       <span class="n">credit</span>
<span class="n">Purchaser_email_domain</span>       <span class="n">gmail</span><span class="o">.</span><span class="n">com</span>
<span class="n">Recipient_email_domain</span>       <span class="n">gmail</span><span class="o">.</span><span class="n">com</span>
<span class="n">Device_operating_system</span>            <span class="n">NaN</span>
<span class="n">Browser_version</span>            <span class="n">chrome</span> <span class="mf">63.0</span>
<span class="n">Resolution</span>                         <span class="n">NaN</span>
<span class="n">DeviceInfo</span>                     <span class="n">Windows</span>
<span class="n">DeviceType</span>                     <span class="n">desktop</span>
<span class="n">TransactionAmt</span>                  <span class="mf">81.037</span>
<span class="n">TransactionID</span>                <span class="mf">3135204.0</span>
<span class="n">addr1</span>                              <span class="n">NaN</span>
<span class="n">addr2</span>                              <span class="n">NaN</span>
<span class="n">card1</span>                           <span class="mf">2256.0</span>
<span class="n">card2</span>                            <span class="mf">545.0</span>
<span class="n">card3</span>                            <span class="mf">185.0</span>
<span class="n">card5</span>                            <span class="mf">226.0</span>
<span class="n">dist1</span>                              <span class="n">NaN</span>
<span class="n">dist2</span>                             <span class="mf">17.0</span>
<span class="n">Count_1</span>                           <span class="mf">37.0</span>
<span class="n">Count_2</span>                           <span class="mf">47.0</span>
<span class="n">Count_3</span>                            <span class="mf">0.0</span>
<span class="n">Count_4</span>                           <span class="mf">13.0</span>
<span class="n">Count_5</span>                            <span class="mf">0.0</span>
<span class="n">Count_6</span>                           <span class="mf">13.0</span>
<span class="n">Count_7</span>                           <span class="mf">13.0</span>
<span class="n">Count_8</span>                           <span class="mf">28.0</span>
<span class="n">Count_9</span>                            <span class="mf">0.0</span>
<span class="n">Name</span><span class="p">:</span> <span class="mi">6466</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="n">Label</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Predicted</span> <span class="n">Value</span><span class="p">:</span> <span class="mf">0.8809023171385614</span>
</pre></div>
</div>
<p>Here is the model’s worst <strong>false negative</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">worst_fn_idx</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
<span class="n">worst_fn_example</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">worst_fn_idx</span><span class="p">,:]</span>
<span class="n">worst_fn_pred</span> <span class="o">=</span> <span class="n">model_wrapper</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">worst_fn_example</span><span class="p">)</span>
<span class="n">worst_fn_label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">worst_fn_idx</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WORST FALSE NEGATIVE:</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n\n</span><span class="s2">Label: </span><span class="si">{}</span><span class="s2">, Predicted Value: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">worst_fn_example</span><span class="p">,</span> <span class="n">worst_fn_label</span><span class="p">,</span> <span class="n">worst_fn_pred</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Output</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WORST</span> <span class="n">FALSE</span> <span class="n">NEGATIVE</span><span class="p">:</span>
<span class="n">Timestamp</span>                     <span class="mf">12761407.0</span>
<span class="n">Product_type</span>                           <span class="n">W</span>
<span class="n">Card_company</span>                        <span class="n">visa</span>
<span class="n">Card_type</span>                          <span class="n">debit</span>
<span class="n">Purchaser_email_domain</span>     <span class="n">anonymous</span><span class="o">.</span><span class="n">com</span>
<span class="n">Recipient_email_domain</span>               <span class="n">NaN</span>
<span class="n">Device_operating_system</span>              <span class="n">NaN</span>
<span class="n">Browser_version</span>                      <span class="n">NaN</span>
<span class="n">Resolution</span>                           <span class="n">NaN</span>
<span class="n">DeviceInfo</span>                           <span class="n">NaN</span>
<span class="n">DeviceType</span>                           <span class="n">NaN</span>
<span class="n">TransactionAmt</span>                    <span class="mf">1795.8</span>
<span class="n">TransactionID</span>                  <span class="mf">3476245.0</span>
<span class="n">addr1</span>                              <span class="mf">184.0</span>
<span class="n">addr2</span>                               <span class="mf">87.0</span>
<span class="n">card1</span>                             <span class="mf">4436.0</span>
<span class="n">card2</span>                              <span class="mf">174.0</span>
<span class="n">card3</span>                              <span class="mf">150.0</span>
<span class="n">card5</span>                              <span class="mf">226.0</span>
<span class="n">dist1</span>                                <span class="n">NaN</span>
<span class="n">dist2</span>                                <span class="n">NaN</span>
<span class="n">Count_1</span>                              <span class="mf">1.0</span>
<span class="n">Count_2</span>                              <span class="mf">1.0</span>
<span class="n">Count_3</span>                              <span class="mf">0.0</span>
<span class="n">Count_4</span>                              <span class="mf">0.0</span>
<span class="n">Count_5</span>                              <span class="mf">1.0</span>
<span class="n">Count_6</span>                              <span class="mf">1.0</span>
<span class="n">Count_7</span>                              <span class="mf">0.0</span>
<span class="n">Count_8</span>                              <span class="mf">0.0</span>
<span class="n">Count_9</span>                              <span class="mf">1.0</span>
<span class="n">Name</span><span class="p">:</span> <span class="mi">9385</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>

<span class="n">Label</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Predicted</span> <span class="n">Value</span><span class="p">:</span> <span class="mf">0.00330668052035523</span>
</pre></div>
</div>
</section>
<section id="granular-analysis">
<h4>Granular Analysis<a class="headerlink" href="#granular-analysis" title="Permalink to this heading"></a></h4>
<p>For more subset specific analysis, we can run the <code class="docutils literal notranslate"><span class="pre">get_worst_overall_subset</span></code> function
which returns a dictionary of the worst performing subsets for each feature.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rime.tabular.performance.error_analysis</span> <span class="kn">import</span> <span class="n">get_worst_overall_subset</span>

<span class="n">worst_subsets</span> <span class="o">=</span> <span class="n">get_worst_overall_subset</span><span class="p">(</span><span class="n">test_data_container</span><span class="p">)</span>
<span class="n">worst_subsets</span>
</pre></div>
</div>
<p><strong>Output</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">:</span> <span class="s1">&#39;[88174.0, 1208944.3]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Product_type&#39;</span><span class="p">:</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Card_company&#39;</span><span class="p">:</span> <span class="s1">&#39;discover&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Card_type&#39;</span><span class="p">:</span> <span class="s1">&#39;debit&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Purchaser_email_domain&#39;</span><span class="p">:</span> <span class="s1">&#39;yahoo.com&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Recipient_email_domain&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Device_operating_system&#39;</span><span class="p">:</span> <span class="s1">&#39;Windows 7&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Browser_version&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Resolution&#39;</span><span class="p">:</span> <span class="s1">&#39;1334x750&#39;</span><span class="p">,</span>
 <span class="s1">&#39;DeviceInfo&#39;</span><span class="p">:</span> <span class="s1">&#39;Trident/7.0&#39;</span><span class="p">,</span>
 <span class="s1">&#39;DeviceType&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span>
 <span class="s1">&#39;TransactionAmt&#39;</span><span class="p">:</span> <span class="s1">&#39;(100.0, 117.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;TransactionID&#39;</span><span class="p">:</span> <span class="s1">&#39;[2987101.0, 3038557.2]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;addr1&#39;</span><span class="p">:</span> <span class="s1">&#39;(325.0, 330.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;addr2&#39;</span><span class="p">:</span> <span class="s1">&#39;(87.0, 96.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;card1&#39;</span><span class="p">:</span> <span class="s1">&#39;(16573.5, 18375.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;card2&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span>
 <span class="s1">&#39;card3&#39;</span><span class="p">:</span> <span class="s1">&#39;[100.0, 150.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;card5&#39;</span><span class="p">:</span> <span class="s1">&#39;(226.0, 237.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;dist1&#39;</span><span class="p">:</span> <span class="s1">&#39;(1.0, 2.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;dist2&#39;</span><span class="p">:</span> <span class="s1">&#39;(74.222, 150.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Count_1&#39;</span><span class="p">:</span> <span class="s1">&#39;(2.0, 3.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Count_2&#39;</span><span class="p">:</span> <span class="s1">&#39;[0, 1.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Count_3&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Count_4&#39;</span><span class="p">:</span> <span class="s1">&#39;[0, 1.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Count_5&#39;</span><span class="p">:</span> <span class="s1">&#39;(1.0, 3.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Count_6&#39;</span><span class="p">:</span> <span class="s1">&#39;[0, 1.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Count_7&#39;</span><span class="p">:</span> <span class="s1">&#39;(1.0, 2252.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Count_8&#39;</span><span class="p">:</span> <span class="s1">&#39;[0, 1.0]&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Count_9&#39;</span><span class="p">:</span> <span class="s1">&#39;(1.0, 2.0]&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Finally, if more granular analysis is desired, you can pass in the metrics to analyze and determine the worst subsets for only those metrics.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rime.tabular.performance.error_analysis</span> <span class="kn">import</span> <span class="n">get_worst_subsets_for_metrics</span>
<span class="kn">from</span> <span class="nn">rime.tabular.metric</span> <span class="kn">import</span> <span class="n">AccuracyMetric</span>

<span class="n">worst_subsets_for_metrics</span> <span class="o">=</span> <span class="n">get_worst_subsets_for_metrics</span><span class="p">(</span><span class="n">test_data_container</span><span class="p">,</span>
                                                          <span class="p">[</span><span class="n">AccuracyMetric</span><span class="p">])</span>
<span class="n">worst_subsets_for_metrics</span>
</pre></div>
</div>
<p><strong>Output</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(4613225.0, 6027819.5]&#39;</span><span class="p">,</span> <span class="mf">0.9575098814229249</span><span class="p">)},</span>
 <span class="s1">&#39;Product_type&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mf">0.9137055837563451</span><span class="p">)},</span>
 <span class="s1">&#39;Card_company&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;discover&#39;</span><span class="p">,</span> <span class="mf">0.9351851851851852</span><span class="p">)},</span>
 <span class="s1">&#39;Card_type&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;credit&#39;</span><span class="p">,</span> <span class="mf">0.9375244045294807</span><span class="p">)},</span>
 <span class="s1">&#39;Purchaser_email_domain&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;hotmail.com&#39;</span><span class="p">,</span> <span class="mf">0.9470443349753694</span><span class="p">)},</span>
 <span class="s1">&#39;Recipient_email_domain&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;hotmail.com&#39;</span><span class="p">,</span> <span class="mf">0.9246861924686193</span><span class="p">)},</span>
 <span class="s1">&#39;Device_operating_system&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Windows 7&#39;</span><span class="p">,</span> <span class="mf">0.9646017699115044</span><span class="p">)},</span>
 <span class="s1">&#39;Browser_version&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;chrome 64.0&#39;</span><span class="p">,</span> <span class="mf">0.9241379310344827</span><span class="p">)},</span>
 <span class="s1">&#39;Resolution&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1366x768&#39;</span><span class="p">,</span> <span class="mf">0.9291338582677166</span><span class="p">)},</span>
 <span class="s1">&#39;DeviceInfo&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Windows&#39;</span><span class="p">,</span> <span class="mf">0.9427570093457944</span><span class="p">)},</span>
 <span class="s1">&#39;DeviceType&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;mobile&#39;</span><span class="p">,</span> <span class="mf">0.9260823653643083</span><span class="p">)},</span>
 <span class="s1">&#39;TransactionAmt&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(280.0, 3967.81]&#39;</span><span class="p">,</span> <span class="mf">0.9436619718309859</span><span class="p">)},</span>
 <span class="s1">&#39;TransactionID&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(3188929.0, 3239251.0]&#39;</span><span class="p">,</span> <span class="mf">0.9575098814229249</span><span class="p">)},</span>
 <span class="s1">&#39;addr1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="mf">0.9154929577464789</span><span class="p">)},</span>
 <span class="s1">&#39;addr2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(87.0, 96.0]&#39;</span><span class="p">,</span> <span class="mf">0.9090909090909091</span><span class="p">)},</span>
 <span class="s1">&#39;card1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(13044.0, 15111.0]&#39;</span><span class="p">,</span> <span class="mf">0.9539267015706806</span><span class="p">)},</span>
 <span class="s1">&#39;card2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="mf">0.9310344827586207</span><span class="p">)},</span>
 <span class="s1">&#39;card3&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(150.0, 185.0]&#39;</span><span class="p">,</span> <span class="mf">0.9087221095334685</span><span class="p">)},</span>
 <span class="s1">&#39;card5&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(126.0, 166.0]&#39;</span><span class="p">,</span> <span class="mf">0.9616766467065868</span><span class="p">)},</span>
 <span class="s1">&#39;dist1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(208.889, 4568.0]&#39;</span><span class="p">,</span> <span class="mf">0.9599109131403119</span><span class="p">)},</span>
 <span class="s1">&#39;dist2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(7.0, 9.0]&#39;</span><span class="p">,</span> <span class="mf">0.8571428571428571</span><span class="p">)},</span>
 <span class="s1">&#39;Count_1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(3.0, 7.0]&#39;</span><span class="p">,</span> <span class="mf">0.9504854368932039</span><span class="p">)},</span>
 <span class="s1">&#39;Count_2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(7.0, 5690.0]&#39;</span><span class="p">,</span> <span class="mf">0.9535374868004224</span><span class="p">)},</span>
 <span class="s1">&#39;Count_3&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="mf">0.96921071106208</span><span class="p">)},</span>
 <span class="s1">&#39;Count_4&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(1.0, 2250.0]&#39;</span><span class="p">,</span> <span class="mf">0.8878718535469108</span><span class="p">)},</span>
 <span class="s1">&#39;Count_5&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;[0, 1.0]&#39;</span><span class="p">,</span> <span class="mf">0.9647382261534784</span><span class="p">)},</span>
 <span class="s1">&#39;Count_6&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(5.0, 2250.0]&#39;</span><span class="p">,</span> <span class="mf">0.9632183908045977</span><span class="p">)},</span>
 <span class="s1">&#39;Count_7&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(1.0, 2252.0]&#39;</span><span class="p">,</span> <span class="mf">0.8470149253731343</span><span class="p">)},</span>
 <span class="s1">&#39;Count_8&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;(1.0, 3328.0]&#39;</span><span class="p">,</span> <span class="mf">0.9001663893510815</span><span class="p">)},</span>
 <span class="s1">&#39;Count_9&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;[0, 1.0]&#39;</span><span class="p">,</span> <span class="mf">0.9671781756180733</span><span class="p">)}}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="improving-model-performance-results-overweighting">
<h2>Improving Model Performance Results: Overweighting<a class="headerlink" href="#improving-model-performance-results-overweighting" title="Permalink to this heading"></a></h2>
<p>After using RIME to identify weaknesses of your model, it’s time to improve your model’s performance. One method of doing this is to increase the training weights of underperforming subsets. Let’s try to increase the performance of subset <code class="docutils literal notranslate"><span class="pre">C</span></code> in the feature <code class="docutils literal notranslate"><span class="pre">Product_type</span></code>, which currently has an accuracy of ~91%.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">worst_subsets_for_metrics</span><span class="p">[</span><span class="s2">&quot;Product_type&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Output</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mf">0.9137055837563451</span><span class="p">)}</span>
</pre></div>
</div>
<section id="training-the-initial-model">
<h3>Training the Initial Model<a class="headerlink" href="#training-the-initial-model" title="Permalink to this heading"></a></h3>
<p>We can proceed in the regular way to train the model.</p>
<p>First, we preprocess our train and test data for our model</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_pre</span> <span class="o">=</span> <span class="n">preprocess_df</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
<span class="n">train_preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">train_pre</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">COL</span> <span class="o">=</span> <span class="s1">&#39;Product_type&#39;</span>
<span class="n">VAL</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>
<span class="n">train_df_full</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">train_df_full</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_labels</span>
<span class="n">train_df_full</span><span class="p">[</span><span class="s1">&#39;preds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_preds</span>
</pre></div>
</div>
<p>And then, we adjust the subset sample weights and retrain</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sample_weights</span> <span class="o">=</span> <span class="p">(</span><span class="n">train_pre</span><span class="p">[</span><span class="n">COL</span><span class="p">]</span> <span class="o">==</span> <span class="n">VAL</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">categorical_features_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">train_pre</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">new_model</span> <span class="o">=</span> <span class="n">catb</span><span class="o">.</span><span class="n">CatBoostClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">new_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_pre</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weights</span><span class="p">,</span> <span class="n">cat_features</span><span class="o">=</span><span class="n">categorical_features_indices</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="comparing-improvements">
<h3>Comparing Improvements<a class="headerlink" href="#comparing-improvements" title="Permalink to this heading"></a></h3>
<p>We can define a new predict_dict function and create a new container to calculate updated metrics.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predict_dict_new_model</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Predict dict function.&quot;&quot;&quot;</span>
    <span class="n">new_x</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">new_x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">new_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">new_x</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

<span class="n">new_data_container</span> <span class="o">=</span> <span class="n">DataContainer</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">model_task</span><span class="o">=</span><span class="n">ModelTask</span><span class="o">.</span><span class="n">BINARY_CLASSIFICATION</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">train_labels</span><span class="p">)</span>
<span class="n">test_data_container</span> <span class="o">=</span> <span class="n">DataContainer</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">test_df</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">test_labels</span><span class="p">,</span> <span class="n">model_task</span><span class="o">=</span><span class="n">ModelTask</span><span class="o">.</span><span class="n">BINARY_CLASSIFICATION</span><span class="p">,</span> <span class="n">ref_data</span><span class="o">=</span><span class="n">data_container</span><span class="p">)</span>
<span class="n">new_container</span> <span class="o">=</span> <span class="n">TabularRunContainer</span><span class="o">.</span><span class="n">from_predict_dict_function</span><span class="p">(</span><span class="n">new_data_container</span><span class="p">,</span> <span class="n">test_data_container</span><span class="p">,</span> <span class="n">predict_dict_new_model</span><span class="p">,</span> <span class="n">ModelTask</span><span class="o">.</span><span class="n">BINARY_CLASSIFICATION</span><span class="p">)</span>
</pre></div>
</div>
<p>Calculating overall metrics, despite our rather simple adjustment, <strong>the accuracy increases to ~96%</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">new_worst_subsets_for_metrics</span> <span class="o">=</span> <span class="n">get_worst_subsets_for_metrics</span><span class="p">(</span><span class="n">new_data_container</span><span class="p">,</span> <span class="p">[</span><span class="n">MetricName</span><span class="o">.</span><span class="n">ACCURACY</span><span class="p">])</span>
<span class="n">new_worst_subsets_for_metrics</span><span class="p">[</span><span class="s2">&quot;Product_type&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Output</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mf">0.9650974025974026</span><span class="p">)}</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="rime_adversarial.html" class="btn btn-neutral float-left" title="Adversarial Attacks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../reference.html" class="btn btn-neutral float-right" title="API Test Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Robust Intelligence.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
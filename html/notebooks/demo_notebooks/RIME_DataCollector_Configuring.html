<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using a Data Collector for Scheduled Continuous Testing &mdash; Robust Intelligence  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/nbsphinx-code-cells.css" type="text/css" />
      <link rel="stylesheet" href="https://cdn.datatables.net/v/dt/dt-1.13.1/sb-1.4.0/datatables.min.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="../../_static/main.js"></script>
        <script src="https://cdn.datatables.net/v/dt/dt-1.13.1/sb-1.4.0/datatables.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Scheduling Continuous Testing runs" href="../../testing_and_monitoring/monitoring_models/scheduling_ct_runs.html" />
    <link rel="prev" title="Loading Data for Scheduled Continuous Testing" href="../../testing_and_monitoring/monitoring_models/loading_data_for_scheduled_ct.html" />
<link href="../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">
<div class="ge_header no-print">
    <a id="header-logo" href="../../index.html">
        <img src="../../_static/header-logo.png" alt="logo" />
    </a>
</div>


  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Robust Intelligence
          </a>
              <div class="version">
                2.1.0-rc.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation Home</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation_home/robust_intelligence_intro.html">What is Robust Intelligence?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation_home/get_started.html">Get Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Testing and Monitoring</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../testing_and_monitoring/creating_projects.html">Creating Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing_and_monitoring/preparing_your_models_and_datasets.html">Preparing your Models and Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing_and_monitoring/validating_models.html">Validate Models with Stress Tests</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../testing_and_monitoring/monitoring_models.html">Monitor Models with Continuous Tests</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../testing_and_monitoring/monitoring_models/creating_new_continuous_test.html">Creating a new Continuous Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="RIME_Firewall_Configuring.html">Updating your Continuous Test</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../testing_and_monitoring/monitoring_models/loading_data_for_scheduled_ct.html">Loading Data for Scheduled Continuous Testing</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../testing_and_monitoring/monitoring_models/loading_data_for_scheduled_ct.html#delta-lake">Delta Lake</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../testing_and_monitoring/monitoring_models/loading_data_for_scheduled_ct.html#data-collector">Data Collector</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Using a Data Collector for Scheduled Continuous Testing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../testing_and_monitoring/monitoring_models/loading_data_for_scheduled_ct.html#custom-loader">Custom Loader</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../testing_and_monitoring/monitoring_models/scheduling_ct_runs.html">Scheduling Continuous Testing runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing_and_monitoring/monitoring_models/configuring_scheduled_ct.html">Configuring your Scheduled Continuous Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing_and_monitoring/monitoring_models/ct_feedback_and_observability.html">Continuous Testing Feedback and Observability</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../testing_and_monitoring/configuring_test_runs.html">Configuring your Test Runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing_and_monitoring/querying_results.html">Querying Test Run Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing_and_monitoring/notifications_and_alerts.html">Notifications and Alerts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing_and_monitoring/model_governance.html">Managing Model Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing_and_monitoring/integrating_mlops.html">Integrating with MLOps</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../administration/organization_administration.html">Organization Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/workspace_configuration.html">Workspace Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/security_and_compliance.html">Security and Compliance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deployment</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deployment/faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/python-sdk.html">Python SDK reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/troubleshooting.html">Troubleshooting Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/model_tests_reference.html">Model Tests Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/api_changelog.html">API Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Robust Intelligence</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../testing_and_monitoring/monitoring_models.html">Monitor Models with Continuous Tests</a></li>
          <li class="breadcrumb-item"><a href="../../testing_and_monitoring/monitoring_models/loading_data_for_scheduled_ct.html">Loading Data for Scheduled Continuous Testing</a></li>
      <li class="breadcrumb-item active">Using a Data Collector for Scheduled Continuous Testing</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Using-a-Data-Collector-for-Scheduled-Continuous-Testing">
<h1>Using a Data Collector for Scheduled Continuous Testing<a class="headerlink" href="#Using-a-Data-Collector-for-Scheduled-Continuous-Testing" title="Permalink to this heading"></a></h1>
<p>In this Notebook walkthrough, we will show how to create an <strong>AI Firewall</strong>, log points to a <strong>data collector</strong>, and <strong>schedule automatic tests</strong> with it. The Data Collector can be used to log datapoints in a production setting and batch setting, which can be coupled with a a scheduler to automatically run continuous tests on data, with no extra configuration. We will also show you how to kick off manual testing runs with the collector.</p>
<p><strong>Create a Firewall and Schedule Tests</strong> After specifying the required credentials, run the cells below to install libraries, run stress testing, and deploy an AI Firewall with Data Collector. For a more fine-grained walkthrough of this code, please reference our Fraud Onboarding Walkthrough.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">API_TOKEN</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># PASTE API_KEY</span>
<span class="n">CLUSTER_URL</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># PASTE DEDICATED DOMAIN OF RIME SERVICE (eg: rime.stable.rbst.io)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># See the Fraud Onboarding Walkthrough for more information on the following code</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>rime-sdk<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>https://github.com/RobustIntelligence/ri-public-examples/archive/master.zip
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">TemporaryDirectory</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">ri_public_examples.download_files</span> <span class="kn">import</span> <span class="n">download_files</span>
<span class="kn">from</span> <span class="nn">rime_sdk</span> <span class="kn">import</span> <span class="n">Client</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rime_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">CLUSTER_URL</span><span class="p">,</span> <span class="n">API_TOKEN</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Create an AI Firewall, log data directly to the Robust Intelligence platform,&quot;</span>
    <span class="s2">&quot; and schedule automated Continuous Testing of your deployed model. All using&quot;</span>
    <span class="s2">&quot; the RIME SDK. Demonstration uses a tabular binary classification dataset&quot;</span>
    <span class="s2">&quot; and model that simulates credit card fraud detection.&quot;</span>
<span class="p">)</span>
<span class="n">project</span> <span class="o">=</span> <span class="n">rime_client</span><span class="o">.</span><span class="n">create_project</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;AI Firewall Data Collector Demo&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fetch example data</span>
<span class="n">download_files</span><span class="p">(</span><span class="s1">&#39;tabular/fraud&#39;</span><span class="p">,</span> <span class="s1">&#39;fraud&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Upload data to cluster storage</span>
<span class="n">upload_path</span> <span class="o">=</span> <span class="s2">&quot;ri_public_examples_fraud&quot;</span>
<span class="n">rime_training_path</span> <span class="o">=</span> <span class="n">rime_client</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;fraud/data/fraud_ref.csv&#39;</span><span class="p">),</span> <span class="n">upload_path</span><span class="o">=</span><span class="n">upload_path</span><span class="p">)</span>
<span class="n">rime_testing_path</span> <span class="o">=</span> <span class="n">rime_client</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;fraud/data/fraud_eval.csv&#39;</span><span class="p">),</span> <span class="n">upload_path</span><span class="o">=</span><span class="n">upload_path</span><span class="p">)</span>
<span class="n">fraud_model_path</span> <span class="o">=</span> <span class="n">rime_client</span><span class="o">.</span><span class="n">upload_directory</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;fraud/models&#39;</span><span class="p">),</span> <span class="n">upload_path</span><span class="o">=</span><span class="n">upload_path</span><span class="p">)</span>
<span class="n">fraud_model_path</span> <span class="o">=</span> <span class="n">fraud_model_path</span> <span class="o">+</span> <span class="s2">&quot;/fraud_model.py&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run Stress Tests</span>
<span class="n">stress_test_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;run_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Fraud Model&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data_info&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;pred_col&quot;</span><span class="p">:</span> <span class="s2">&quot;preds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;label_col&quot;</span><span class="p">:</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ref_path&quot;</span><span class="p">:</span> <span class="n">rime_training_path</span><span class="p">,</span>
        <span class="s2">&quot;eval_path&quot;</span><span class="p">:</span> <span class="n">rime_testing_path</span>
    <span class="p">},</span>
    <span class="s2">&quot;model_info&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">fraud_model_path</span>
    <span class="p">},</span>
    <span class="s2">&quot;model_task&quot;</span><span class="p">:</span><span class="s2">&quot;Binary Classification&quot;</span>
<span class="p">}</span>
<span class="n">stress_job</span> <span class="o">=</span> <span class="n">rime_client</span><span class="o">.</span><span class="n">start_stress_test</span><span class="p">(</span><span class="n">test_run_config</span><span class="o">=</span><span class="n">stress_test_config</span><span class="p">,</span> <span class="n">project_id</span><span class="o">=</span><span class="n">project</span><span class="o">.</span><span class="n">project_id</span><span class="p">)</span>
<span class="n">stress_job</span><span class="o">.</span><span class="n">get_status</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wait_until_finish</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">stress_test_run</span> <span class="o">=</span> <span class="n">stress_job</span><span class="o">.</span><span class="n">get_test_run</span><span class="p">()</span>

<span class="c1"># You can view the test run results in the provided link</span>
<span class="n">stress_test_run</span>
</pre></div>
</div>
</div>
<section id="Upload-Continuous-Testing-Data-to-the-Data-Collector">
<h2><strong>Upload Continuous Testing Data to the Data Collector</strong><a class="headerlink" href="#Upload-Continuous-Testing-Data-to-the-Data-Collector" title="Permalink to this heading"></a></h2>
<p>The following function simulates a batch upload of production data to the data collector in a real time setting.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rime_sdk.data_collector</span> <span class="kn">import</span> <span class="n">DataCollector</span>
<span class="c1"># Load the data to be used to simulate multiple days of production</span>
<span class="n">continuous_testing_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;fraud/data/fraud_incremental.csv&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">log_datapoints</span><span class="p">(</span>
    <span class="n">data_collector</span><span class="p">:</span> <span class="n">DataCollector</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pred_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timestamp_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">keep_timestamps</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log Dataframe to Data Collector&quot;&quot;&quot;</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">pred_col</span><span class="p">])</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">label_col</span><span class="p">])</span>
    <span class="n">timestamps</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">keep_timestamps</span><span class="p">:</span>
        <span class="n">timestamps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">])</span>
    <span class="n">df_dict</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">pred_col</span><span class="p">,</span> <span class="n">label_col</span><span class="p">,</span> <span class="n">timestamp_col</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
    <span class="n">data_collector</span><span class="o">.</span><span class="n">log_datapoints</span><span class="p">(</span>
        <span class="n">df_dict</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">timestamps</span><span class="o">=</span><span class="n">timestamps</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>You can see the current Firewall status in the UI by clicking the link below. Events will populate once you run the subsequent cell.</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an AI Firewall</span>
<span class="n">firewall</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">create_firewall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Data Collector Scheduled CT Firewall&quot;</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="n">test_run_id</span><span class="o">=</span><span class="n">stress_test_run</span><span class="o">.</span><span class="n">test_run_id</span><span class="p">)</span>
<span class="n">firewall</span>
</pre></div>
</div>
</div>
<p><strong>Activate the Schedule and Use the Data Collector</strong></p>
<p>The scheduler can be configured to run according to the bin size of the data - every hour, every day, etc. Configure a schedule associated with the firewall, to run with data from the data collector. Then get the data collector and start logging points. We will be attaching real-time timestamps to these datapoints to simulate a production setting. This is done by default in the data collector if no timestamps are attached.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Activate a Schedule for the Data Collector</span>
<span class="n">firewall</span><span class="o">.</span><span class="n">activate_ct_schedule</span><span class="p">(</span><span class="n">location_type</span><span class="o">=</span><span class="s2">&quot;data_collector&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the Data Collector</span>
<span class="n">collector</span> <span class="o">=</span> <span class="n">firewall</span><span class="o">.</span><span class="n">get_data_collector</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PRED_COL</span> <span class="o">=</span> <span class="s2">&quot;preds&quot;</span>
<span class="n">LABEL_COL</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span>
<span class="n">TIMESTAMP_COL</span> <span class="o">=</span> <span class="s2">&quot;timestamp&quot;</span>

<span class="c1"># Log datapoints to the collector</span>
<span class="n">log_datapoints</span><span class="p">(</span><span class="n">collector</span><span class="p">,</span> <span class="n">continuous_testing_data</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">PRED_COL</span><span class="p">,</span> <span class="n">label_col</span><span class="o">=</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="n">timestamp_col</span><span class="o">=</span><span class="n">TIMESTAMP_COL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now that you’ve logged datapoints to the data collector, the scheduler should display results within an hour.</p>
</section>
<section id="Create-a-Firewall-and-Test-Data-Manually">
<h2><strong>Create a Firewall and Test Data Manually</strong><a class="headerlink" href="#Create-a-Firewall-and-Test-Data-Manually" title="Permalink to this heading"></a></h2>
<p>You can also use the data collector in manual Continuous Testing runs without depending on the scheduler</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">project</span> <span class="o">=</span> <span class="n">rime_client</span><span class="o">.</span><span class="n">create_project</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Firewall Data Collector Manual Configuration Demo&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;This is an Onboarding Demo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stress_job</span> <span class="o">=</span> <span class="n">rime_client</span><span class="o">.</span><span class="n">start_stress_test</span><span class="p">(</span><span class="n">test_run_config</span><span class="o">=</span><span class="n">stress_test_config</span><span class="p">,</span> <span class="n">project_id</span><span class="o">=</span><span class="n">project</span><span class="o">.</span><span class="n">project_id</span><span class="p">)</span>
<span class="n">stress_job</span><span class="o">.</span><span class="n">get_status</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wait_until_finish</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">stress_test_run</span> <span class="o">=</span> <span class="n">stress_job</span><span class="o">.</span><span class="n">get_test_run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an AI Firewall</span>
<span class="n">firewall</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">create_firewall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Data Collector Manual Firewall&quot;</span><span class="p">,</span> <span class="n">bin_size</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span> <span class="n">test_run_id</span><span class="o">=</span><span class="n">stress_test_run</span><span class="o">.</span><span class="n">test_run_id</span><span class="p">)</span>
<span class="n">firewall</span>
</pre></div>
</div>
</div>
<p>For this example, we will keep the original timestamps associated with the data. The Data Collector has a TTL of 1 year, so we will need to adjust the timestamps first.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="n">continuous_testing_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;fraud/data/fraud_incremental.csv&quot;</span><span class="p">)</span>

<span class="n">curr_year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
<span class="n">continuous_testing_data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">continuous_testing_data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;2018&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">curr_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_format</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span>
<span class="n">earliest_timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">continuous_testing_data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">time_format</span><span class="p">)</span>
<span class="n">latest_timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">continuous_testing_data</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">time_format</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the Data Collector</span>
<span class="n">collector</span> <span class="o">=</span> <span class="n">firewall</span><span class="o">.</span><span class="n">get_data_collector</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PRED_COL</span> <span class="o">=</span> <span class="s2">&quot;preds&quot;</span>
<span class="n">LABEL_COL</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span>
<span class="n">TIMESTAMP_COL</span> <span class="o">=</span> <span class="s2">&quot;timestamp&quot;</span>

<span class="c1"># Log datapoints to the collector</span>
<span class="n">log_datapoints</span><span class="p">(</span><span class="n">collector</span><span class="p">,</span> <span class="n">continuous_testing_data</span><span class="p">,</span> <span class="n">pred_col</span><span class="o">=</span><span class="n">PRED_COL</span><span class="p">,</span> <span class="n">label_col</span><span class="o">=</span><span class="n">LABEL_COL</span><span class="p">,</span> <span class="n">timestamp_col</span><span class="o">=</span><span class="n">TIMESTAMP_COL</span><span class="p">,</span> <span class="n">keep_timestamps</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s run a continuous test from 08/01 to 08/15. The continuous testing config expects start time and end time to be in unix seconds, so we need to do a quick conversion below and start the test. You can review the results in the UI below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">request_end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">curr_year</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">incremental_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;eval_data_info&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;data_collector&quot;</span><span class="p">,</span>
        <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">earliest_timestamp</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()),</span>
        <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">request_end_date</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">ct_job</span> <span class="o">=</span> <span class="n">firewall</span><span class="o">.</span><span class="n">start_continuous_test</span><span class="p">(</span><span class="n">incremental_config</span><span class="p">)</span>
<span class="n">ct_job</span><span class="o">.</span><span class="n">get_status</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wait_until_finish</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">firewall</span>
</pre></div>
</div>
</div>
<section id="Update-Reference-Set">
<h3>Update Reference Set<a class="headerlink" href="#Update-Reference-Set" title="Permalink to this heading"></a></h3>
<p>Now suppose that we have updated your model by retraining on new data from the first half of August. We want to update our deployed Firewall to reflect the new reference dataset.</p>
<p>However, it’s even easier to adapt all of the tests and configuration parameters by updating the firewall based on the data stored on the collector during that time period.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update the reference set by setting the reference time period to the first have of august</span>
<span class="n">firewall</span><span class="o">.</span><span class="n">update_scheduled_ct_info</span><span class="p">(</span><span class="n">location_type</span><span class="o">=</span><span class="s2">&quot;data_collector&quot;</span><span class="p">,</span> <span class="n">reference_set_time_bin</span><span class="o">=</span><span class="p">(</span><span class="n">earliest_timestamp</span><span class="p">,</span> <span class="n">request_end_date</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can see that the &#39;refDataInfo&#39;, which is the reference set now contains the reference period we set it to</span>
<span class="c1"># in unix seconds</span>
<span class="n">firewall</span><span class="o">.</span><span class="n">get_config</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Let’s kick off another continuous test run for the second half of August, now that we’ve changed our baseline data</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the new request start date to 08/16</span>
<span class="n">new_start_date</span> <span class="o">=</span> <span class="n">request_end_date</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">new_incremental_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;eval_data_info&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;data_collector&quot;</span><span class="p">,</span>
        <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_start_date</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()),</span>
        <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">latest_timestamp</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">ct_job</span> <span class="o">=</span> <span class="n">firewall</span><span class="o">.</span><span class="n">start_continuous_test</span><span class="p">(</span><span class="n">new_incremental_config</span><span class="p">)</span>
<span class="n">ct_job</span><span class="o">.</span><span class="n">get_status</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wait_until_finish</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">firewall</span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../testing_and_monitoring/monitoring_models/loading_data_for_scheduled_ct.html" class="btn btn-neutral float-left" title="Loading Data for Scheduled Continuous Testing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../testing_and_monitoring/monitoring_models/scheduling_ct_runs.html" class="btn btn-neutral float-right" title="Scheduling Continuous Testing runs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Robust Intelligence.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
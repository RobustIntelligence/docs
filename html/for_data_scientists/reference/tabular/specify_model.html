<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Specify a Model &mdash; RIME  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="https://cdn.datatables.net/v/dt/dt-1.13.1/sb-1.4.0/datatables.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script src="../../../_static/main.js"></script>
        <script src="https://cdn.datatables.net/v/dt/dt-1.13.1/sb-1.4.0/datatables.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Data Profiling Configuration" href="data_profiling.html" />
    <link rel="prev" title="Model Configuration" href="model_source.html" />
<link href="../../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">
<div class="ge_header no-print">
    <a id="header-logo" href="../../../index.html">
        <img src="../../../_static/header-logo.png" alt="logo" />
    </a>
</div>


  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            RIME
          </a>
              <div class="version">
                2.0.0-beta.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changelogs.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RIME at a Glance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getstarted/index.html">RIME overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data science with RIME</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get_started.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../basic_tasks.html">Basic tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../adv_tasks.html">Advanced concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../reference.html">Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../tabular.html">Tabular Configuration</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../tabular.html#rime-configuration">RIME Configuration</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="stress_testing.html">AI Stress Testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="continuous_testing.html">AI Firewall Continuous Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="task_data_format.html">Input Data Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="data_source.html">Data Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="model_source.html">Model Configuration</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Specify a Model</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tabular.html#profiling-configuration">Profiling Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tabular.html#tests-configuration">Tests Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../nlp.html">NLP Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cv.html">CV Configuration</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administering RIME</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../for_admins/index.html">Administering the RI Platform</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installing RIME</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/index.html">Installation Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SDK reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../python_library/index.html">RIME Python SDK</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RIME</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../reference.html">Reference</a></li>
          <li class="breadcrumb-item"><a href="../tabular.html">Tabular Configuration</a></li>
      <li class="breadcrumb-item active">Specify a Model</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/for_data_scientists/reference/tabular/specify_model.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="specify-a-model">
<h1>Specify a Model<a class="headerlink" href="#specify-a-model" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>RIME expects models to be passed in as Python files that expose one of the following functions:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">predict_dict</span></code>: the input is a single row in dictionary form (e.g. <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">{'Age':</span> <span class="pre">15,</span> <span class="pre">'Animal':</span> <span class="pre">'Cat',</span> <span class="pre">...}</span></code>). For binary classification and regression, the output should
be a float prediction - for binary classification it should be between 0 and 1,
for regression it can be unbounded. The function signature should look like:
<code class="docutils literal notranslate"><span class="pre">predict_dict(x:</span> <span class="pre">dict)</span> <span class="pre">-&gt;</span> <span class="pre">float</span></code>. For multi-class classification the output
should be a numpy array where the ith dimension represents the predicted
probability for the ith class. The function signature
changes slightly to look like: <code class="docutils literal notranslate"><span class="pre">predict_dict(x:</span> <span class="pre">dict)</span> <span class="pre">-&gt;</span> <span class="pre">np.ndarray</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">predict_df</span></code>: the input is a Pandas DataFrame. If the model task is multi-class
classification, the output should be a NumPy array of floats of shape <code class="docutils literal notranslate"><span class="pre">(len(df),</span> <span class="pre">num_classes)</span></code>. For all other model tasks, the output
should be a NumPy array of floats of shape <code class="docutils literal notranslate"><span class="pre">(len(df),)</span></code>.
In either case, the function signature should look like: <code class="docutils literal notranslate"><span class="pre">predict_df(df:</span> <span class="pre">pd.DataFrame)</span> <span class="pre">-&gt;</span> <span class="pre">np.ndarray</span></code></p>
<p>NOTE: for binary classification the return type should be a single float per row which represents the probability for the positive class. It should not be an array of probabilities for each class. E.g. <code class="docutils literal notranslate"><span class="pre">predict_df</span></code> should return <code class="docutils literal notranslate"><span class="pre">[0.7,</span> <span class="pre">0.1,</span> <span class="pre">...]</span></code> NOT <code class="docutils literal notranslate"><span class="pre">[[0.3,</span> <span class="pre">0.7],</span> <span class="pre">[0.9,</span> <span class="pre">0.1],</span> <span class="pre">...]</span></code>.</p>
</li>
</ul>
<p>The following shows how to set up the Python interface RIME expects for a model that can be called via loading a model binary.</p>
<section id="step-1-specify-model-path">
<h2>Step 1: Specify model path<a class="headerlink" href="#step-1-specify-model-path" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Put your model binary, and any other relevant model artifacts, in the same folder as this file.
Create a constant for the path to this binary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">cur_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span>

<span class="n">MODEL_NAME</span> <span class="o">=</span> <span class="s1">&#39;TODO: change this to model name&#39;</span>
<span class="n">MODEL_PATH</span> <span class="o">=</span> <span class="n">cur_dir</span> <span class="o">/</span> <span class="n">MODEL_NAME</span>
</pre></div>
</div>
</section>
<section id="step-2-retrieve-custom-code">
<h2>Step 2: Retrieve custom code<a class="headerlink" href="#step-2-retrieve-custom-code" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>If custom code is needed to perform preprocessing on the data (or to call your API), we need to make sure it is loaded into the environment. If this code is able to be installed as a Python package, see the <code class="docutils literal notranslate"><span class="pre">Custom</span> <span class="pre">Requirements</span></code> section.</p>
<p>If your code is NOT a Python package (and is instead a Python file or folder) then please put all relevant files in the same directory as this file, and add the following snippet to the Python file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cur_dir</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="step-3-access-the-model">
<h2>Step 3: Access the model<a class="headerlink" href="#step-3-access-the-model" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>As an example, if you used the Python <code class="docutils literal notranslate"><span class="pre">pickle</span></code> module to save your model this would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">MODEL_PATH</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="step-4-import-implement-preprocessing-function">
<h2>Step 4: Import / implement preprocessing function<a class="headerlink" href="#step-4-import-implement-preprocessing-function" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>If the model you are using expects inputs of a different schema than the datasets you‚Äôve provided, or of a different type than <code class="docutils literal notranslate"><span class="pre">dict</span></code>/<code class="docutils literal notranslate"><span class="pre">Pandas.DataFrame</span></code>, you will need to load/define all custom preprocessing. If your model can take in the raw data directly then you can skip this step! Getting the preprocessing functionality could look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">custom_package</span> <span class="kn">import</span> <span class="n">preprocessing</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">preprocessing</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelInputType</span><span class="p">:</span>
    <span class="c1"># TODO: implement preprocessing logic.</span>
</pre></div>
</div>
</section>
<section id="step-5-implement-a-predict-function">
<h2>Step 5: Implement a predict function<a class="headerlink" href="#step-5-implement-a-predict-function" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Implement either the <code class="docutils literal notranslate"><span class="pre">predict_dict</span></code> function or the <code class="docutils literal notranslate"><span class="pre">predict_df</span></code> function. This should look something like:</p>
<p>(NOTE: whichever you choose to implement, it must match one of the function names and signatures below.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># In multi-class case, the return type is np.ndarray</span>
<span class="k">def</span> <span class="nf">predict_dict</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">single_input</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">model_output</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">single_input</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model_output</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>OR</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predict_df</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="n">array_input</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">model_output</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">array_input</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model_output</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="model_source.html" class="btn btn-neutral float-left" title="Model Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="data_profiling.html" class="btn btn-neutral float-right" title="Data Profiling Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Robust Intelligence.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
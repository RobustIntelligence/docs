<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RIME ü§ù Airflow &mdash; RIME  documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="https://cdn.datatables.net/v/dt/dt-1.13.1/sb-1.4.0/datatables.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script src="../../../../_static/clipboard.min.js"></script>
        <script src="../../../../_static/copybutton.js"></script>
        <script src="../../../../_static/main.js"></script>
        <script src="https://cdn.datatables.net/v/dt/dt-1.13.1/sb-1.4.0/datatables.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="RIME ü§ù Databricks" href="databricks.html" />
    <link rel="prev" title="Platform Integrations" href="../../platform_integrations.html" />
<link href="../../../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">
<div class="ge_header no-print">
    <a id="header-logo" href="../../../../index.html">
        <img src="../../../../_static/header-logo.png" alt="logo" />
    </a>
</div>


  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            RIME
          </a>
              <div class="version">
                2.0.0-beta.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../changelogs.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">RIME at a Glance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../getstarted/product-overview.html">RIME and machine learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getstarted/workspace-overview.html">The RIME Workspace Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getstarted/modeltesting.html">RIME model testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getstarted/modeltesting.html#rime-local-trial">RIME local trial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data science with RIME</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../get_started.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basic_tasks.html">Basic tasks</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../adv_tasks.html">Advanced tasks</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../adv_tasks.html#integrations-and-customization">Integrations and customization</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../platform_integrations.html">Platform Integrations</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">RIME ü§ù Airflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="databricks.html">RIME ü§ù Databricks</a></li>
<li class="toctree-l4"><a class="reference internal" href="datarobot.html">RIME ü§ù DataRobot</a></li>
<li class="toctree-l4"><a class="reference internal" href="huggingface.html">RIME ü§ù Hugging Face</a></li>
<li class="toctree-l4"><a class="reference internal" href="mlflow.html">RIME ü§ù MLflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="sagemaker.html">RIME ü§ù SageMaker</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../model_integrations.html">Model Integrations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../data_integrations.html">Data Integrations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../customization/custom_metrics.html">Custom Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../customization/custom_tests.html">Custom Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../customization/custom_docker.html">Run RIME on Managed Docker Images</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../adv_tasks.html#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference.html">Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administering RIME</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../for_admins/userauthnz.html">Users, authorization, and authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../for_admins/naviconf.html">Navigating and configuring RIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../for_admins/fixtrouble.html">Troubleshooting a RIME deployment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installing RIME</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/index.html">Installation Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/cloudinst.html">Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/mcloudinst.html">Managed Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/shostedinst.html">Self-Hosted</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SDK reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../python_library/get_started.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python_library/python-sdk.html">Python SDK reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python_library/how_to_guides.html">Python SDK tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python_library/reference.html">API Test Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">RIME</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../adv_tasks.html">Advanced tasks</a></li>
          <li class="breadcrumb-item"><a href="../../platform_integrations.html">Platform Integrations</a></li>
      <li class="breadcrumb-item active">RIME ü§ù Airflow</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/for_data_scientists/how_to_guides/integrations/platform/airflow.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rime-airflow">
<h1>RIME ü§ù Airflow<a class="headerlink" href="#rime-airflow" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>RIME integrates with Airflow. Airflow allows you to schedule RIME test runs,
programmatically kick-off RIME and query for test results.</p>
<p>To get a better understanding
of the integration, take a look at the
<a href="https://www.loom.com/share/e7596da7c13e40ce86ce7a913d925669" target="_blank">Airflow Demo Video,</a>
or follow along through the walkthrough below.</p>
<p><strong>Background</strong>:</p>
<p><em>You are a data scientist at a Payment Processing Company. The data science team has been tasked with implementing a Fraud Detection service and monitoring how that model performs over time.</em></p>
<p><em>Your company‚Äôs data infrastructure and ETL processes are all scheduled in Airflow, and your team uses MLFLow‚Äôs model registry to track model versions and associated metadata.</em></p>
<p><strong>Overview</strong>:</p>
<p>In this walkthrough, we will review 2 of RIME‚Äôs core products - AI Stress Testing and AI Firewall.</p>
<ul class="simple">
<li><p>AI Stress Testing is used in the model development stage. Using AI Stress Testing you can test the developed model. RIME goes beyond simply optimizing for basic model performance like accuracy and automatically discovers the model‚Äôs weaknesses.</p></li>
<li><p>AI Firewall is used after the model is deployed. Using AI Firewall, you can automate the monitoring, discovery and remediation of issues that occur post-deployment. Additionally it automatically flags, blocks, or imputes erroneous data in real-time.</p></li>
</ul>
<p><strong>Requirements</strong>:</p>
<p>This script assumes you are using python version &gt;= 3.8 and running MacOS or Linux. If you are using Windows, please run using WSL or contact an RI representative for assistance.</p>
<p><strong>Setup</strong>:</p>
<p>First, download the associated <a class="reference external" href="https://www.dropbox.com/s/pxj7sjmcjuxepnn/airflow.zip?dl=1">DAG definitions and startup script</a>. Unzip the file and navigate to the folder in your terminal. To make sure we connect to the correct RIME endpoint, set the <code class="docutils literal notranslate"><span class="pre">RIME_API_KEY</span></code> and <code class="docutils literal notranslate"><span class="pre">RIME_UPLOAD_URL</span></code>  environment variables to their appropriate values using, e.g.,
<code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">RIME_UPLOAD_URL=rime.&lt;my_cluster&gt;.rime.dev</span></code>. Please note that the cluster cannot be <code class="docutils literal notranslate"><span class="pre">localhost</span></code>.</p>
<p>If you already have a remote instance of Airflow running and wish to use that, assign the correct values to the RIME upload URL and API token variables directly in <code class="docutils literal notranslate"><span class="pre">airflow_demo.py</span></code> and upload to the appropriate DAG directory (e.g., the configured S3 bucket). Please ensure the required dependencies are installed. If you still wish to use MLflow, update the <code class="docutils literal notranslate"><span class="pre">MLFLOW_TRACKING_URI</span></code> variable to point to the correct server. You can then skip running the accompanying shell script.</p>
<p>The rest of the tutorial assumes you wish to run everything locally. Start from a fresh virtual environment</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>virtualenv<span class="w"> </span>./.venv<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>.<span class="w"> </span>./.venv/bin/activate
</pre></div>
</div>
<p>and proceed by launching a standalone version of Airflow using the companion script <code class="docutils literal notranslate"><span class="pre">run_airflow.sh</span></code>. The script does the following:</p>
<ul class="simple">
<li><p>Install Airflow, MLflow, and the rime-sdk</p></li>
<li><p>Move the DAGs defined in <code class="docutils literal notranslate"><span class="pre">airflow_demo.py</span></code> to the dag folder to be scheduled.</p></li>
<li><p>Spin up the Airflow services (scheduler, database, web server, etc.) backed by a SQLite database</p></li>
<li><p>Spin up an MLFLow server backed by a SQLite database to track the experiments</p></li>
</ul>
<p>Once this is done, copy the password printed out by the script, and login to the local Airflow instance
at <a class="reference external" href="http://localhost:8081/">http://localhost:8081/</a> using ‚Äúadmin‚Äù as the username.</p>
<p><img alt="Airflow Login" src="../../../../_images/login_screenshot.png" /></p>
<p>Enable the ‚ÄúRIME_Stress_Testing‚Äù workflow to begin developing models. While you are waiting, you can continue the walkthrough below.</p>
<p><img alt="Enable Stress Testing DAG" src="../../../../_images/enable_dag.png" /></p>
<p>The RIME DAGs shown on the Airflow webpage are defined in <code class="docutils literal notranslate"><span class="pre">airflow_demo.py</span></code>. These do the following:</p>
<ul class="simple">
<li><p>The first DAG (<code class="docutils literal notranslate"><span class="pre">RIME_Stress_Testing</span></code>) defines an automatic model development pipeline. It creates MLflow experiments for three different models and adds them to the model registry.  For each experiment, it</p>
<ul>
<li><p>Trains the model on the reference split.</p></li>
<li><p>Evaluates the model using common metrics on the heldout evaluation split.</p></li>
<li><p>Uploads the model and data to the RIME cluster to stress test the trained models.</p></li>
<li><p>Queries the stress testing runs to add all metrics and test results to the MLFLow experiment.</p></li>
<li><p>Saves the model so it can be loaded in a framework-agnostic manner using MLflow‚Äôs model logging API.</p></li>
</ul>
</li>
</ul>
<p>It then uses the stress testing results to select the best-performing model and promote it to production in MLflow. The model is wrapped with the AI Firewall to protect it in production.</p>
<p>This DAG is defined as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DAG</span><span class="p">(</span>
    <span class="n">dag_id</span><span class="o">=</span><span class="s2">&quot;RIME_Stress_Testing&quot;</span><span class="p">,</span>
    <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span><span class="p">,</span>
    <span class="n">schedule_interval</span><span class="o">=</span><span class="s2">&quot;@once&quot;</span><span class="p">,</span> 
    <span class="n">start_date</span><span class="o">=</span><span class="n">DEPLOYMENT_DATE</span><span class="p">,</span>
    <span class="n">catchup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">preprod_dag</span><span class="p">:</span>
    <span class="n">create_project_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;create_rime_project&quot;</span><span class="p">,</span> <span class="n">python_callable</span><span class="o">=</span><span class="n">create_rime_project</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fetch_train_data_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;fetch_train_data&quot;</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">fetch_fraud_data</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;split&quot;</span><span class="p">:</span> <span class="s2">&quot;train&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">fetch_test_data_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;fetch_test_data&quot;</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">fetch_fraud_data</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;split&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="p">[</span><span class="n">fetch_train_data_task</span><span class="p">,</span> <span class="n">fetch_test_data_task</span><span class="p">]</span>
    <span class="n">log_results_to_mlflow_tasks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">model_types</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;catboost-classifier&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sgd-classifier&quot;</span><span class="p">,</span>
        <span class="s2">&quot;logistic-regression-classifier&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">model_type</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_types</span><span class="p">):</span>
        <span class="n">train_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
            <span class="n">task_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;train_model_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">python_callable</span><span class="o">=</span><span class="n">train_model</span><span class="p">,</span>
            <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="n">model_type</span><span class="p">,},</span>
            <span class="n">show_return_value_in_logs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">model_val_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model_val&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)}</span>
        <span class="n">model_upload_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
            <span class="n">task_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;upload_model_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">python_callable</span><span class="o">=</span><span class="n">upload_model</span><span class="p">,</span>
            <span class="n">op_kwargs</span><span class="o">=</span><span class="n">model_val_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ref_upload_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
            <span class="n">task_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;add_preds_and_upload_ref_dataset_file_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">python_callable</span><span class="o">=</span><span class="n">add_preds_and_upload_dataset_file</span><span class="p">,</span>
            <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;split&quot;</span><span class="p">:</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">model_val_kwargs</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">eval_upload_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
            <span class="n">task_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;add_preds_and_upload_eval_dataset_file_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">python_callable</span><span class="o">=</span><span class="n">add_preds_and_upload_dataset_file</span><span class="p">,</span>
            <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;split&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">model_val_kwargs</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">stress_tests_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
            <span class="n">task_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;run_stress_test_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">python_callable</span><span class="o">=</span><span class="n">run_stress_test</span><span class="p">,</span>
            <span class="n">op_kwargs</span><span class="o">=</span><span class="n">model_val_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">mlflow_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
            <span class="n">task_id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;log_results_to_mlflow_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">python_callable</span><span class="o">=</span><span class="n">log_results_to_mlflow</span><span class="p">,</span>
            <span class="n">op_kwargs</span><span class="o">=</span><span class="n">model_val_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">upload_tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_upload_task</span><span class="p">,</span> <span class="n">ref_upload_task</span><span class="p">,</span> <span class="n">eval_upload_task</span><span class="p">]</span>
        <span class="n">root</span> <span class="o">&gt;&gt;</span> <span class="n">train_task</span> <span class="o">&gt;&gt;</span> <span class="n">upload_tasks</span> <span class="o">&gt;&gt;</span> <span class="n">stress_tests_task</span> <span class="o">&gt;&gt;</span> <span class="n">mlflow_task</span>
        <span class="n">create_project_task</span> <span class="o">&gt;&gt;</span> <span class="n">stress_tests_task</span>
        <span class="n">log_results_to_mlflow_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mlflow_task</span><span class="p">)</span>

    <span class="n">selection_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;choose_best_model&quot;</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">choose_best_model</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;model_types&quot;</span><span class="p">:</span> <span class="n">model_types</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">deploy_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;transition_best_model_to_production&quot;</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">transition_best_model_to_production</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">create_firewall_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;create_firewall&quot;</span><span class="p">,</span> <span class="n">python_callable</span><span class="o">=</span><span class="n">create_firewall</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">log_results_to_mlflow_tasks</span> <span class="o">&gt;&gt;</span> <span class="n">selection_task</span> <span class="o">&gt;&gt;</span> <span class="n">deploy_task</span> <span class="o">&gt;&gt;</span> <span class="n">create_firewall_task</span>
</pre></div>
</div>
<p>The actual <code class="docutils literal notranslate"><span class="pre">python_callables</span></code> can be viewed in the downloaded <code class="docutils literal notranslate"><span class="pre">airflow_demo.py</span></code> file.</p>
<p>You can view the DAG computation graph and monitor the development pipeline‚Äôs progress in the Airflow webpage.</p>
<p><img alt="Training Progress Graph" src="../../../../_images/stress_testing_dag.png" /></p>
<p>An MLflow tracking server was also launched as a part of this walkthrough. To view the model experiments, try navigating to <a class="reference external" href="http://localhost:7081/">http://localhost:7081/</a>.</p>
<p><img alt="MLflow Top Level" src="../../../../_images/mlflow_top_level.png" /></p>
<p>As the <code class="docutils literal notranslate"><span class="pre">RIME_Stress_Testing</span></code> DAG is computed, the MLflow experiments and model registry will be populated with the model files, training and RIME metrics, and even the associated RIME web links. The best-performing model will be moved to production automatically.</p>
<p><img alt="MLflow Model View" src="../../../../_images/production_model.png" /></p>
<p>Once this DAG completes, you can check out the RIME stress tests in the web interface
corresponding to your RIME_UPLOAD_URL. As mentioned above, the Stress Test URL is added to MLflow run tags under the key ‚ÄúRIME Stress Test Link‚Äù as well as to the run parameters. Navigate to the <a class="reference external" href="http://localhost:7081/#/experiments/1/runs">local MLflow tracking server</a> to view the <code class="docutils literal notranslate"><span class="pre">airflow_demo</span></code> experiments, then click one of the runs (listed in the ‚ÄúStart Time‚Äù column) to view the tags.</p>
<p><img alt="MLflow Run Tags" src="../../../../_images/mlflow_run_tags.png" /></p>
<p>From the experiment view, navigate to the link specified by the <code class="docutils literal notranslate"><span class="pre">RIME</span> <span class="pre">Stress</span> <span class="pre">Test</span> <span class="pre">Link</span></code> tag.</p>
<p><img alt="RIME Project" src="../../../../_images/airflow_rime_project.png" /></p>
<p>Congrats! Your model is now live. Enable the ‚ÄúRIME_Firewall‚Äù DAG using the toggle in the Airflow web interface or by using the Airflow CLI to protect and monitor the model.</p>
<p><img alt="Firewall Toggle" src="../../../../_images/firewall_toggle.png" /></p>
<p>The <code class="docutils literal notranslate"><span class="pre">RIME_Firewall</span></code> DAG fetches batches of production data and feeds it to the model, running continuous tests on the data to monitor drift, anomalies, and other AI security threats.</p>
<p>This DAG is defined as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">DAG</span><span class="p">(</span>
    <span class="n">dag_id</span><span class="o">=</span><span class="s2">&quot;RIME_Firewall&quot;</span><span class="p">,</span>
    <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span><span class="p">,</span>
    <span class="n">schedule_interval</span><span class="o">=</span><span class="s2">&quot;@daily&quot;</span><span class="p">,</span>
    <span class="n">start_date</span><span class="o">=</span><span class="n">DEPLOYMENT_DATE</span><span class="p">,</span>
    <span class="n">end_date</span><span class="o">=</span><span class="n">PRODUCTION_END_DATE</span><span class="p">,</span>
    <span class="n">catchup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">prod_dag</span><span class="p">:</span>
    <span class="n">interval_start</span> <span class="o">=</span> <span class="s2">&quot;{{ data_interval_start }}&quot;</span>
    <span class="n">interval_end</span> <span class="o">=</span> <span class="s2">&quot;{{ data_interval_end }}&quot;</span>
    <span class="n">fetch_prod_data_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;fetch_production_data&quot;</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">fetch_production_data</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;interval_start&quot;</span><span class="p">:</span> <span class="n">interval_start</span><span class="p">,</span> <span class="s2">&quot;interval_end&quot;</span><span class="p">:</span> <span class="n">interval_end</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="c1"># Only run the firewall if the DF from fetch_production_data is not empty</span>
    <span class="n">short_circuit_task</span> <span class="o">=</span> <span class="n">ShortCircuitOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;continue_if_data_available&quot;</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">continue_if_data_available</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">get_project_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;get_rime_project_id&quot;</span><span class="p">,</span> <span class="n">python_callable</span><span class="o">=</span><span class="n">get_rime_project_id</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">add_prod_preds_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;add_prod_preds&quot;</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">add_prod_preds_and_upload_dataset_file</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">run_firewall_task</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;run_firewall&quot;</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">run_incremental_firewall</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;interval_start&quot;</span><span class="p">:</span> <span class="n">interval_start</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">fetch_prod_data_task</span> <span class="o">&gt;&gt;</span> <span class="n">short_circuit_task</span> <span class="o">&gt;&gt;</span> <span class="n">add_prod_preds_task</span> <span class="o">&gt;&gt;</span> <span class="n">run_firewall_task</span>
    <span class="n">get_project_task</span> <span class="o">&gt;&gt;</span> <span class="n">run_firewall_task</span>
</pre></div>
</div>
<p>This will run the firewall over the month of
production data. You can view the testing process in the Airflow UI.</p>
<p><img alt="Firewall Grid Process" src="../../../../_images/firewall_run_grid.png" /></p>
<p>After a few iterations, navigate to the Firewall link (in the target RIME project; also present in the MLflow production model registry) and evaluate the most recent evaluation bins.</p>
<p><img alt="Firewall Events" src="../../../../_images/realtime_events.png" /></p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../platform_integrations.html" class="btn btn-neutral float-left" title="Platform Integrations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="databricks.html" class="btn btn-neutral float-right" title="RIME ü§ù Databricks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Robust Intelligence.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
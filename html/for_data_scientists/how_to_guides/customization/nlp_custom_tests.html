<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NLP Generic Custom Tests &mdash; RIME  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
        <script src="../../../_static/main.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Run RIME on Managed Docker Images" href="custom_docker.html" />
    <link rel="prev" title="Tabular Custom Abnormal Inputs Test" href="tabular_custom_abnormal_inputs_tests.html" />
<link href="../../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">
<div class="ge_header no-print">
    <a id="header-logo" href="../../../index.html">
        <img src="../../../_static/header-logo.png" alt="logo" />
    </a>
</div>


  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            RIME
          </a>
              <div class="version">
                0.20.15
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changelogs.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getstarted/index.html">RIME overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administering the RI Platform</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../for_admins/index.html">Administering the RI Platform</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installing the RI Platform</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/index.html">Installation Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data science with the RI Platform</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get_started.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../how_to_guides.html">How-To Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/api-authentication.html">API Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/adversarial_nlp.html">NLP Adversarial Robustness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/compare_test_runs.html">Comparing Two Test Runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/compliance.html">Compliance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/upload_data.html">Uploading Data to RIME</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/querying_results.html">Querying RIME Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/updating_a_firewall.html">Updating a Firewall</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/using_data_collector.html">Using the Data Collector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/scheduling_ct_runs.html">Scheduling Continuous Testing Runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/rest_api.html">Using the REST API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/modelcards.html">Model cards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/embeddings.html">Custom embeddings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/projects.html">Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platform_integrations.html">Platform Integrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model_integrations.html">Model Integrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_integrations.html">Data Integrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alerting/setup_alerts.html">Alerts and Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alerting/test_run_progress.html">Test Run Progress</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_metrics.html">Custom Metrics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="custom_tests.html">Custom Tests</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tabular_custom_tests.html">Tabular Custom Generic Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="tabular_custom_abnormal_inputs_tests.html">Tabular Custom Abnormal Inputs Test</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">NLP Generic Custom Tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="custom_docker.html">Run RIME on Managed Docker Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/sdk.html">Debugging the Python SDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/rime_data_format_check.html">RIME Data Format Check</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">RIME in-depth reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RIME</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../how_to_guides.html">How-To Guides</a></li>
          <li class="breadcrumb-item"><a href="custom_tests.html">Custom Tests</a></li>
      <li class="breadcrumb-item active">NLP Generic Custom Tests</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/for_data_scientists/how_to_guides/customization/nlp_custom_tests.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nlp-generic-custom-tests">
<h1>NLP Generic Custom Tests<a class="headerlink" href="#nlp-generic-custom-tests" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>With RIME, it is easy to specify custom tests. The below steps walk through how to do so. If you run into any difficulties, please contact your Robust Intelligence support engineer and they will assist you.</p>
<p>First, you must define a custom test in a Python file.</p>
<p>This Python file should expose a class named CustomBatchRunner, which should inherit from the TestBatchRunner interface that RIME defines.
After inheriting from this class you will need to implement 6 methods:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_from_config</span></code>: this is a class method that takes in a RunContainer and a config and returns the CustomBatchRunner initialized with a list of TestCases (see below for information on what a test is).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">table_columns_to_show</span></code>: this property is responsible for telling the UI which columns to show in the test case table.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">description</span></code>: a property with a description of the test, only used in the UI.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">long_description</span></code>: a property with a long description of the test, only used in the UI.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: a property with the type of the test, only used in the UI.</p></li>
</ol>
<p>As mentioned above, this CustomBatchRunner will contain multiple TestCases.
These are a collection of test cases that will be aggregated inside the overall batch runner.
As an example of this, if you write a specific test that you want to apply to each column in the dataset, it would make sense to have the BatchRunner be initialized with a list of tests, one for each feature.</p>
<p>The test cases that you define should inherit from the BaseTest class that RIME defines.
After inheriting from this class you will need to implement one method:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">run</span></code>: this method takes in a UnstructuredRunContainer and returns a TestOutput (the result of the test) and a dictionary of extra info (that can be used when aggregating test results in the BatchRunner)</p></li>
</ol>
<p>An example of a custom test file is below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Test batch runner for custom tests.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">from</span> <span class="nn">rime.core.schema</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CustomConfig</span><span class="p">,</span>
    <span class="n">ImportanceLevel</span><span class="p">,</span>
    <span class="n">Status</span><span class="p">,</span>
    <span class="n">TableColumn</span><span class="p">,</span>
    <span class="n">TestCategory</span><span class="p">,</span>
    <span class="n">TestOutput</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">rime.core.test</span> <span class="kn">import</span> <span class="n">BaseTest</span>
<span class="kn">from</span> <span class="nn">rime.nlp.model_tests.batch_runner</span> <span class="kn">import</span> <span class="n">TestBatchRunner</span>
<span class="kn">from</span> <span class="nn">rime.nlp.run_container</span> <span class="kn">import</span> <span class="n">RunContainer</span>


<span class="k">class</span> <span class="nc">CustomTest</span><span class="p">(</span><span class="n">BaseTest</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize with a delta between n_rows ref and eval.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_container</span><span class="p">:</span> <span class="n">RunContainer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TestOutput</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
        <span class="n">ref_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">run_container</span><span class="o">.</span><span class="n">ref_data_container</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">eval_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">run_container</span><span class="o">.</span><span class="n">eval_data_container</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ref_count</span> <span class="o">&gt;</span> <span class="n">eval_count</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">WARNING</span>
            <span class="n">severity</span> <span class="o">=</span> <span class="n">ImportanceLevel</span><span class="o">.</span><span class="n">HIGH</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">PASS</span>
            <span class="n">severity</span> <span class="o">=</span> <span class="n">ImportanceLevel</span><span class="o">.</span><span class="n">NONE</span>
        <span class="n">table_info_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Severity&quot;</span><span class="p">:</span> <span class="n">severity</span><span class="p">,</span>
            <span class="s2">&quot;Info&quot;</span><span class="p">:</span> <span class="s2">&quot;Compare size of datasets&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Key Detail&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Size of reference data: </span><span class="si">{</span><span class="n">ref_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">test_output</span> <span class="o">=</span> <span class="n">TestOutput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">table_info_dict</span><span class="p">,</span> <span class="n">severity</span><span class="p">,</span> <span class="p">[],)</span>
        <span class="k">return</span> <span class="n">test_output</span><span class="p">,</span> <span class="p">{}</span>


<span class="k">class</span> <span class="nc">CustomBatchRunner</span><span class="p">(</span><span class="n">TestBatchRunner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;TestBatchRunner for the CustomTest.&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_config</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">run_container</span><span class="p">:</span> <span class="n">RunContainer</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">CustomConfig</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CustomBatchRunner&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;delta&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">([</span><span class="n">CustomTest</span><span class="p">(</span><span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">)])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">table_columns_to_show</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TableColumn</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the types of info to show in the test case table.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">TableColumn</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Info&quot;</span><span class="p">,</span> <span class="s2">&quot;Severity&quot;</span><span class="p">,</span> <span class="s2">&quot;Key Detail&quot;</span><span class="p">]]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;This is custom test&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">long_description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;This is a long description of a custom test.&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;customer custom test&quot;</span>

</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tabular_custom_abnormal_inputs_tests.html" class="btn btn-neutral float-left" title="Tabular Custom Abnormal Inputs Test" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="custom_docker.html" class="btn btn-neutral float-right" title="Run RIME on Managed Docker Images" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Robust Intelligence.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tabular Custom Abnormal Inputs Test &mdash; RIME  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="NLP Generic Custom Tests" href="nlp_custom_tests.html" />
    <link rel="prev" title="Tabular Custom Generic Tests" href="tabular_custom_tests.html" />
<link href="../../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">
<div class="ge_header no-print">
    <a id="header-logo" href="../../../index.html">
        <img src="../../../_static/header-logo.png" alt="logo" />
    </a>
</div>


  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            RIME
          </a>
              <div class="version">
                0.19.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get_started.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../how_to_guides.html">How-To Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/api-authentication.html">API Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/compare_test_runs.html">Comparing Two Test Runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/compliance.html">Compliance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/projects.html">Create and Manage Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/upload_data.html">Uploading Data to RIME</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/querying_results.html">Querying RIME Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/updating_a_firewall.html">Updating a Firewall</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/using_data_collector.html">Using the Data Collector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/scheduling_ct_runs.html">Scheduling Continuous Testing Runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_use_cases/rest_api.html">Using the REST API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../platform_integrations.html">Platform Integrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../model_integrations.html">Model Integrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_integrations.html">Data Integrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alerting/setup_alerts.html">Alerts and Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alerting/test_run_progress.html">Test Run Progress</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_metrics.html">Custom Metrics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="custom_tests.html">Custom Tests</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tabular_custom_tests.html">Tabular Custom Generic Tests</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Tabular Custom Abnormal Inputs Test</a></li>
<li class="toctree-l3"><a class="reference internal" href="nlp_custom_tests.html">NLP Generic Custom Tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="custom_docker.html">Run RIME on Managed Docker Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/sdk.html">Debugging the Python SDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/rime_data_format_check.html">RIME Data Format Check</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../explanation.html">Explanation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changelogs.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../for_admins/index.html">For Administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../local_trial/index.html">Local Trial</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RIME</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../how_to_guides.html">How-To Guides</a></li>
          <li class="breadcrumb-item"><a href="custom_tests.html">Custom Tests</a></li>
      <li class="breadcrumb-item active">Tabular Custom Abnormal Inputs Test</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/for_data_scientists/how_to_guides/customization/tabular_custom_abnormal_inputs_tests.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tabular-custom-abnormal-inputs-test">
<h1>Tabular Custom Abnormal Inputs Test<a class="headerlink" href="#tabular-custom-abnormal-inputs-test" title="Permalink to this heading"></a></h1>
<p>With RIME, it is easy to specify custom tests. The below steps walk through how to do so. If you run into any difficulties, please contact your Robust Intelligence support engineer and they will assist you.</p>
<p>First, you must define a custom test in a Python file.</p>
<p>This Python file should expose a class named <code class="docutils literal notranslate"><span class="pre">CustomAbnormalInputsBatchRunner</span></code>, which should inherit from the <code class="docutils literal notranslate"><span class="pre">AbstractCustomAbnormalInputsBatchRunner</span></code> interface that RIME defines.
After inheriting from this class you will need to implement 2 methods:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">batch_test_name</span></code>: this is a property that should be unique for each test.
Name collisions with existing tests will cause errors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">abnormal_inputs_criteria</span></code>: this is a class method that takes in your reference and evaluation dataframes and outputs a <code class="docutils literal notranslate"><span class="pre">pd.Series</span></code> object with boolean values, indicating for each row in the <code class="docutils literal notranslate"><span class="pre">evaluation_set</span></code> whether the input is abnormal.
Your implementation can also take in additional arguments that you pass in through the <code class="docutils literal notranslate"><span class="pre">params</span></code> dictionary in your config.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Simple custom abnormal inputs test example.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">rime.tabular.data_tests.custom.abnormal_inputs</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AbstractCustomAbnormalInputsBatchRunner</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">CustomAbnormalInputsBatchRunner</span><span class="p">(</span><span class="n">AbstractCustomAbnormalInputsBatchRunner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a simple example custom abnormal inputs test.</span>

<span class="sd">    This example custom abnormal inputs test returns true for all rows in the eval set</span>
<span class="sd">    whose numerical value for any column is outside the range of the reference set</span>
<span class="sd">    for the specified column.</span>
<span class="sd">    You must implement `abnormal_input_criteria` and `batch_test_name` for this test to</span>
<span class="sd">    work.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">abnormal_inputs_criteria</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">ref_set</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eval_set</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return booleans `pd.Series` with same length as `eval_set`.&quot;&quot;&quot;</span>
        <span class="c1"># get columns with only numerical values</span>
        <span class="n">column_flags</span> <span class="o">=</span> <span class="n">ref_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eval_set</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ref_set</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">column_flags</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">below_threshold</span> <span class="o">=</span> <span class="n">eval_set</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ref_set</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">above_threshold</span> <span class="o">=</span> <span class="n">eval_set</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ref_set</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                <span class="n">failing_rows</span> <span class="o">=</span> <span class="n">below_threshold</span> <span class="o">|</span> <span class="n">above_threshold</span>
                <span class="n">result</span> <span class="o">|=</span> <span class="n">failing_rows</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">batch_test_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return name of test.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Simple Custom Outside Range&quot;</span>


</pre></div>
</div>
<p>There are also several optional methods whose implementation you can override depending on your needs.</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get_batch_args</span></code>: this is a class method that takes in your reference and evaluation dataframes and returns a list of key-word arguments to each run of your test.
You should implement this logic if you want to run the same <code class="docutils literal notranslate"><span class="pre">abnormal_inputs_criteria</span></code> over several tests but with different arguments.
<code class="docutils literal notranslate"><span class="pre">column_names</span></code> is a required key in each dictionary with corresponding value of a list of the column names that this test uses, and this value is used by RIME to help flag features for you.
All other arguments are passed to your implementation of <code class="docutils literal notranslate"><span class="pre">abnormal_inputs_crtieria</span></code>.
Your arguments should avoid name collisions with the keys in the <code class="docutils literal notranslate"><span class="pre">params</span></code> dictionary of your config.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">description</span></code>: this is a property that should return a short description of your test as a string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">starter_string</span></code>: this is a property that should return a longer description of your test as a string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">why_string</span></code>: this is a property that should return a string that explains why this test is useful.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">configuration_string</span></code>: this is a property that should return a string describing the configuration of the test.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">example_string</span></code>: this is a property that should return a string that gives an example of the use-case of this test.</p></li>
</ol>
<p>Each of the strings can be formatted with HTML. The <code class="docutils literal notranslate"><span class="pre">starter_string</span></code>, <code class="docutils literal notranslate"><span class="pre">why_string</span></code>, <code class="docutils literal notranslate"><span class="pre">configuration_string</span></code>, an <code class="docutils literal notranslate"><span class="pre">example_stirng</span></code> properties are displayed in the “ⓘ More” pop-up.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Advanced custom abnormal inputs test example.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">rime.tabular.data_tests.custom.abnormal_inputs</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AbstractCustomAbnormalInputsBatchRunner</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">CustomAbnormalInputsBatchRunner</span><span class="p">(</span><span class="n">AbstractCustomAbnormalInputsBatchRunner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is an advanced example custom abnormal inputs test.</span>

<span class="sd">    This example custom abnormal inputs test runs a batch of tests where each test</span>
<span class="sd">    checks the evaluation data for numerical values that are outside the range of the</span>
<span class="sd">    In addition to the methods required by the simple example, you need to implement</span>
<span class="sd">    `get_batch_args`. Other functions are optional but helpful for</span>
<span class="sd">     interpreting the results from RIME.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">abnormal_inputs_criteria</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">ref_set</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eval_set</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return booleans `pd.Series` with same length as `eval_set`.&quot;&quot;&quot;</span>
        <span class="n">min_val</span> <span class="o">=</span> <span class="n">ref_set</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">max_val</span> <span class="o">=</span> <span class="n">ref_set</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">eval_set</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_val</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">eval_set</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_val</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">batch_test_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return name of test.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Advanced Custom Outside Range&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_batch_args</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">ref_set</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">eval_set</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of kwargs to pass to each test.</span>

<span class="sd">        The `column_names` key is required and expects a list of column names that this</span>
<span class="sd">        test uses. All other kwargs are passed to `abnormal_inputs_criteria`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">column_flags</span> <span class="o">=</span> <span class="n">ref_set</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">batch_args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ref_set</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">column_flags</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">batch_args</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;column_names&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="s2">&quot;column&quot;</span><span class="p">:</span> <span class="n">column</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">batch_args</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return one sentence description of the test.&quot;&quot;&quot;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;This test checks that the numeric features of the data points of the eval &quot;</span>
            <span class="s2">&quot;set are in the range of the numeric features of the data points of the &quot;</span>
            <span class="s2">&quot;reference set.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">description</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tabular_custom_tests.html" class="btn btn-neutral float-left" title="Tabular Custom Generic Tests" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="nlp_custom_tests.html" class="btn btn-neutral float-right" title="NLP Generic Custom Tests" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Robust Intelligence.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>